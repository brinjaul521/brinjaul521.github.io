---
title: Qtæ€è·¯
date: 2025-09-17 14:37:12
tags: Qtå¼€å‘
---
# Qtå¼€å‘

## å¯¹è±¡æ ‘çº§è”é—®é¢˜

æ‰“å°ç»“æœè¯´æ˜ä¸¤ä¸ªçª—å£ **å¯¹è±¡éƒ½æ´»ç€**ï¼Œä½† **`isVisible() == false`**ï¼Œæ‰€ä»¥å®ƒä»¬ **æ ¹æœ¬æ²¡è¢« `show()` æˆåŠŸ**ã€‚  
å‡ºç°è¿™ç§æƒ…å†µåªæœ‰ä¸¤ç§å¯èƒ½ï¼š

1. **ä½ è°ƒç”¨ `show()` çš„å¯¹è±¡å¹¶ä¸æ˜¯ä½ æ­£åœ¨æ‰“å°çš„å¯¹è±¡**ï¼ˆåå­—æˆ–æŒ‡é’ˆæŒ‡é”™äº†ï¼‰ã€‚  
2. **è°ƒç”¨äº† `show()` ä¹‹åï¼Œä»£ç åˆåœ¨åŒä¸€å‡½æ•°é‡ŒæŠŠçª—å£ç«‹åˆ» `hide()` æ‰äº†**ï¼ˆæˆ–æŠŠçˆ¶çª—å£éšè—å¯¼è‡´å­çª—å£ä¹Ÿè¢«éšè—ï¼‰ã€‚

---

### ğŸ” ç°åœºæ’æŸ¥ 2 æ­¥

#### â‘  ç¡®è®¤æ‰“å°çš„å®ä¾‹ == ä½ çœŸæ­£ `show()` çš„å®ä¾‹

åœ¨ `showChildWindow()` é‡ŒåŠ ä¸€è¡Œï¼š

```cpp
qDebug() << "showChildWindow called on" << _childDialog;
_childDialog->show();
qDebug() << "after show:"
         << "visible" << _childDialog->isVisible()
         << "geometry" << _childDialog->geometry();
```

å†å¯¹æ¯”ä½ è°ƒè¯•æ‰“å°é‡Œçš„ `_childDialog` åœ°å€ï¼Œå¦‚æœåœ°å€ä¸ä¸€è‡´ â†’ ä½ æ‰“å°çš„æ˜¯ **å¦ä¸€ä¸ªå®ä¾‹**ã€‚

#### â‘¡ ç¡®è®¤æ²¡æœ‰è¢«ç«‹å³éšè—

æŠŠ `showChildWindow` ç²¾ç®€åˆ°åªæœ‰ä¸¤è¡Œï¼š

```cpp
void MainWindow::showChildWindow()
{
    qDebug() << "before show";
    _childDialog->show();
    qDebug() << "after show" << _childDialog->isVisible();
}
```

- å¦‚æœ **ç¬¬ä¸€æ¬¡** æ‰“å°å°±å¾—åˆ° `visible = false`ï¼Œè¯´æ˜ `show()` è¢«åˆ«çš„ä»£ç  **ç«‹åˆ»æ’¤é”€**ï¼›  
- å¦‚æœ **ç¬¬äºŒæ¬¡** å†æ‰“å°å°±å¾—åˆ° `visible = true`ï¼Œè¯´æ˜ä½ ä¹‹å‰åªæ˜¯ **å¿˜è®°è°ƒç”¨ `show()`** æˆ–è€… **åœ¨åˆ«çš„å‡½æ•°é‡Œåˆ `hide()` äº†**ã€‚

---

### âœ… æœ€å¸¸è§çš„â€œéšå½¢â€é”™è¯¯ç¤ºä¾‹

```cpp
// é”™è¯¯ï¼šåŒä¸€å‡½æ•°é‡Œå…ˆ show å† hide
void MainWindow::showChildWindow()
{
    _childDialog->show();   // ç«‹å³æ˜¾ç¤º
    this->hide();           // ä¸»çª—å£ hide
    // å¦‚æœ _childDialog çš„çˆ¶å¯¹è±¡æ˜¯ thisï¼ŒQt ä¼šçº§è”éšè—å­çª—å£
}
```

ä¿®å¤ï¼š  

- è®©å­çª—å£ **æ— çˆ¶å¯¹è±¡**ï¼ˆä¼  `nullptr`ï¼‰ï¼Œæˆ–  
- æŠŠ `hide()` æ”¾åœ¨ **ä¿¡å·æ§½é‡Œ** å»¶è¿Ÿæ‰§è¡Œï¼Œä¸è¦æ”¾åœ¨åŒä¸€å‡½æ•°é‡Œã€‚

---

### ä¸€å¥è¯ç»“è®º

**`isVisible() == false` å°±è¯æ˜ `show()` æ ¹æœ¬æ²¡ç”Ÿæ•ˆ**ï¼›  
90% æ˜¯å› ä¸º **çˆ¶çª—å£è¢«éšè—å¯¼è‡´å­çª—å£ä¹Ÿè¢«éšè—**ï¼Œæˆ–è€… **ä½ æ‰“å°çš„å®ä¾‹å¹¶ä¸æ˜¯ä½ çœŸæ­£ `show()` çš„å®ä¾‹**ã€‚  
æŒ‰ä¸Šé¢ä¸¤æ­¥æ‰“å°åœ°å€å’Œç”Ÿå‘½å‘¨æœŸå³å¯å®šä½ã€‚

## æ¨¡æ€å¯¹è¯æ¡†è®¾ç½®

Qt ä¸­æŠŠå¯¹è¯æ¡†â€œå˜æ¨¡æ€â€æœ‰ 4 ç§å¸¸ç”¨å†™æ³•ï¼Œå¯å½’çº³ä¸º **ä¸¤ç±» 3 çº§ 4 æ³•**ï¼Œä¸‹é¢æŒ‰ã€Œé˜»å¡èŒƒå›´ Ã— é˜»å¡æ–¹å¼ã€ç»™å‡ºå¯¹ç…§ã€ä¼˜åŠ¿åŠæ¨èåœºæ™¯ã€‚æ‰€æœ‰æ–¹æ³•åœ¨ **Qt5 / Qt6** é€šç”¨ï¼Œå·®å¼‚ä»…é»˜è®¤é€€å‡ºç­–ç•¥ï¼ˆQt6 éœ€ `setQuitOnLastWindowClosed(false)`ï¼‰ã€‚

------------------------------------------------

ä¸€ã€ä¸¤ç±» 3 çº§ 4 æ³•æ€»è§ˆ

| #    | å†™æ³•                                            | é˜»å¡èŒƒå›´       | é˜»å¡æ–¹å¼       | ä½•æ—¶ç”¨       |
| ---- | ----------------------------------------------- | -------------- | -------------- | ------------ |
| 1    | `exec()`                                        | Application çº§ | **åŒæ­¥é˜»å¡**   | å¿…é¡»ç­‰å¾…ç»“æœ |
| 2    | `open()`                                        | Window çº§      | **å¼‚æ­¥éé˜»å¡** | Qt5+ æ¨è    |
| 3    | `setModal(true)` + `show()`                     | Application çº§ | **å¼‚æ­¥éé˜»å¡** | éœ€è¦éé˜»å¡   |
| 4    | `setWindowModality(Qt::WindowModal)` + `show()` | Window çº§      | **å¼‚æ­¥éé˜»å¡** | ä¸ #2 ç­‰ä»·   |

------------------------------------------------

äºŒã€ä»£ç ç¤ºä¾‹ & ä¼˜åŠ¿

1. **exec()**ï¼ˆæœ€ç»å…¸ï¼‰

```cpp
QDialog dlg(this);
if (dlg.exec() == QDialog::Accepted) { /* å¤„ç† */ }
```

- âœ… **åŒæ­¥** â€”â€” ä»£ç åœåœ¨ `exec()`ï¼Œç›´åˆ°ç”¨æˆ·å…³é—­ã€‚  
- âœ… **è‡ªåŠ¨ ApplicationModal** â€”â€” æ•´ä¸ªç¨‹åºè¢«é˜»å¡ã€‚  
- âŒ UI çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œä¸èƒ½ç»§ç»­å“åº”å…¶ä»–äº‹ä»¶ã€‚  
- **æ¨è**ï¼šä¸€æ¬¡æ€§ç¡®è®¤ã€æ–‡ä»¶é€‰æ‹©ã€ç™»å½•æ¡†ã€‚

2. **open()**ï¼ˆQt5+ å®˜æ–¹ä¸»æ¨ï¼‰

```cpp
auto *dlg = new QDialog(this);   // éœ€æŒ‡å®šçˆ¶çª—å£
connect(dlg, &QDialog::finished, this, [this](int r){ /* å¤„ç† */ });
dlg->open();                     // ç­‰ä»·äº setWindowModality + show
```

- âœ… **å¼‚æ­¥** â€”â€” `open()` ç«‹å³è¿”å›ï¼Œä¸ä¼šå¡æ­» UIã€‚  
- âœ… **WindowModal** â€”â€” åªé˜»å¡çˆ¶çª—å£ï¼Œç”¨æˆ·ä½“éªŒæ›´å‹å¥½ã€‚  
- âœ… **å†…å­˜å‹å¥½** â€”â€” å¯é…åˆ `setAttribute(Qt::WA_DeleteOnClose)`ã€‚  
- **æ¨è**ï¼šè®¾ç½®é¢æ¿ã€å±æ€§ç¼–è¾‘ç­‰éœ€è¦çˆ¶çª—å£å†»ç»“çš„åœºæ™¯ã€‚

3. **setModal(true) + show()**

```cpp
QDialog dlg;
dlg.setModal(true);   // ç­‰ä»·äº setWindowModality(Qt::ApplicationModal)
dlg.show();
```

- âœ… åŒæ ·å¼‚æ­¥ï¼Œä½†èŒƒå›´æ˜¯æ•´ä¸ªåº”ç”¨ã€‚  
- âŒ ä»ç„¶éœ€è¦æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚  
- **æ¨è**ï¼šéœ€è¦ ApplicationModal åˆä¸æƒ³ç”¨ `exec()` çš„åœºåˆã€‚

4. **setWindowModality(Qt::WindowModal) + show()**

```cpp
QDialog dlg(this);
dlg.setWindowModality(Qt::WindowModal);
dlg.show();
```

- ä¸ #2 åŠŸèƒ½å®Œå…¨ç­‰ä»·ï¼Œåªæ˜¯å†™æ³•æ›´åŸå§‹ã€‚  
- **æ¨è**ï¼šå½“ä½ ä¸æƒ³ç»§æ‰¿ QDialogï¼Œè€Œæ˜¯ç”¨ QWidget å……å½“å¯¹è¯æ¡†æ—¶ã€‚

------------------------------------------------

ä¸‰ã€å¦‚ä½•é€‰æ‹©

| éœ€æ±‚                         | æ¨èå†™æ³•                                      |
| ---------------------------- | --------------------------------------------- |
| é˜»å¡æ•´ç¨‹åºå¹¶ç­‰å¾…è¿”å›         | `exec()`                                      |
| åªé˜»å¡çˆ¶çª—å£ä¸”å¼‚æ­¥           | `open()`ï¼ˆQt5+ å®˜æ–¹ï¼‰                         |
| éœ€è¦ ApplicationModal ä½†å¼‚æ­¥ | `setModal(true) + show()`                     |
| ç”¨ QWidget åšå¯¹è¯æ¡†          | `setWindowModality(Qt::WindowModal) + show()` |

> **ä¸€å¥è¯æ€»ç»“**ï¼š  
> **Qt5/Qt6 å‡ä¼˜å…ˆç”¨ `dialog->open()`ï¼ˆWindow Modal å¼‚æ­¥ï¼‰**ï¼›  
> å¿…é¡»åŒæ­¥é˜»å¡ã€æˆ–è¦è¿”å›å€¼æ—¶ï¼Œæ‰ç”¨ `exec()`ã€‚



## å¼±æŒ‡é’ˆä¸æ™ºèƒ½æŒ‡é’ˆ

åœ¨æ‚¨æä¾›çš„ä»£ç ä¸­ï¼Œä½¿ç”¨äº† `std::shared_ptr`å’Œ `std::weak_ptr`æ¥ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œè¿™ç§åšæ³•æœ¬èº«æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨æˆ–å†…å­˜æ³„æ¼ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š

### 1. **ä»£ç è¡Œä¸ºåˆ†æ**

```cpp
void LoginDialog::initSignals() {
    _registerDialog = std::make_shared<RegisterDialog>();  // åˆ›å»º RegisterDialog çš„å…±äº«æŒ‡é’ˆ
    _registerDialog->setLogin(shared_from_this());         // ä¼ é€’å½“å‰å¯¹è±¡çš„å…±äº«æŒ‡é’ˆï¼ˆè½¬æ¢ä¸º weak_ptrï¼‰
}
```

- `_registerDialog`æ˜¯ `LoginDialog`çš„æˆå‘˜å˜é‡ï¼ˆç±»å‹ä¸º `std::shared_ptr<RegisterDialog>`ï¼‰ï¼Œå®ƒæŒæœ‰ `RegisterDialog`çš„æ‰€æœ‰æƒã€‚
- `shared_from_this()`è¿”å›å½“å‰ `LoginDialog`å¯¹è±¡çš„ `std::shared_ptr<LoginDialog>`ï¼ˆè¦æ±‚å¯¹è±¡å¿…é¡»å·²è¢« `shared_ptr`ç®¡ç†ï¼‰ã€‚
- `setLogin()`æ¥æ”¶ä¸€ä¸ª `std::weak_ptr<LoginDialog>`ï¼Œèµ‹å€¼ç»™ `RegisterDialog`çš„æˆå‘˜ `_loginDialog`ã€‚

```cpp
void RegisterDialog::setLogin(const std::weak_ptr<LoginDialog> &loginDialog) {
    _loginDialog = loginDialog;  // å­˜å‚¨ä¸ºå¼±æŒ‡é’ˆ
}
```

- `_loginDialog`æ˜¯ `RegisterDialog`çš„æˆå‘˜å˜é‡ï¼ˆç±»å‹ä¸º `std::weak_ptr<LoginDialog>`ï¼‰ï¼Œå®ƒ**ä¸æŒæœ‰æ‰€æœ‰æƒ**ï¼Œä»…è§‚å¯Ÿ `LoginDialog`å¯¹è±¡ã€‚

------

### 2. **å¼•ç”¨è®¡æ•°å˜åŒ–**

- **`std::make_shared<RegisterDialog>()`**
  - åˆ›å»º `RegisterDialog`å¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•° **+1**ï¼ˆ`_registerDialog`æŒæœ‰ï¼‰ã€‚
- **`shared_from_this()`**
  - è¿”å› `LoginDialog`çš„å…±äº«æŒ‡é’ˆï¼Œä½†å¼•ç”¨è®¡æ•°**ä¸å˜**ï¼ˆå› ä¸ºè¯¥æŒ‡é’ˆæ˜¯é¢å¤–çš„å¼•ç”¨ï¼Œä½†å¯¹è±¡å·²è¢«å…¶ä»– `shared_ptr`ç®¡ç†ï¼‰ã€‚
- **è½¬æ¢ä¸º `std::weak_ptr`**
  - å½“ `shared_ptr`èµ‹å€¼ç»™ `weak_ptr`æ—¶ï¼š
    - å¼•ç”¨è®¡æ•°**ä¸å˜**ï¼ˆ`weak_ptr`ä¸å¢åŠ å¼ºå¼•ç”¨è®¡æ•°ï¼‰ã€‚
    - `weak_ptr`ä¼šå…³è”åˆ°æ§åˆ¶å—ï¼Œä½†ä¸ä¼šé˜»æ­¢å¯¹è±¡é”€æ¯ã€‚

------

### 3. **å®‰å…¨æ€§åˆ†æ**

#### âœ… **æ— å¾ªç¯å¼•ç”¨**

- `LoginDialog`æŒæœ‰ `RegisterDialog`çš„ `shared_ptr`ï¼ˆå¼ºå¼•ç”¨ï¼‰ã€‚

- `RegisterDialog`æŒæœ‰ `LoginDialog`çš„ `weak_ptr`ï¼ˆå¼±å¼•ç”¨ï¼Œä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼‰ã€‚

- å½“å¤–éƒ¨ä¸å†æŒæœ‰ `LoginDialog`çš„ `shared_ptr`æ—¶ï¼š

  1. `LoginDialog`å¯¹è±¡é”€æ¯ï¼ˆå¼•ç”¨è®¡æ•°å½’é›¶ï¼‰ã€‚

  2. `LoginDialog`çš„æˆå‘˜ `_registerDialog`ï¼ˆ`shared_ptr<RegisterDialog>`ï¼‰è¢«é”€æ¯ â†’ `RegisterDialog`çš„å¼•ç”¨è®¡æ•°å½’é›¶ â†’ `RegisterDialog`å¯¹è±¡é”€æ¯ã€‚

     **ä¸ä¼š**å› å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ã€‚

#### âœ… **å¼±æŒ‡é’ˆçš„å®‰å…¨è®¿é—®**

- åœ¨ `RegisterDialog`ä¸­é€šè¿‡ `_loginDialog.lock()`è·å– `shared_ptr`ï¼š

  ```cpp
  if (auto login = _loginDialog.lock()) {
      // å®‰å…¨ä½¿ç”¨ login å¯¹è±¡
  }
  ```

- å¦‚æœ `LoginDialog`å·²é”€æ¯ï¼Œ`lock()`è¿”å›ç©ºæŒ‡é’ˆï¼Œé¿å…æ‚¬ç©ºæŒ‡é’ˆã€‚

#### âš ï¸ **æ³¨æ„å‰ææ¡ä»¶**

- `shared_from_this()`è¦æ±‚å¯¹è±¡å¿…é¡»ç”± `shared_ptr`ç®¡ç†ã€‚è‹¥ç›´æ¥æ„é€  `LoginDialog`è€Œéé€šè¿‡ `shared_ptr`ï¼Œä¼šæŠ›å‡º `std::bad_weak_ptr`å¼‚å¸¸ã€‚

  æ­£ç¡®åˆ›å»ºæ–¹å¼ï¼š

  ```cpp
  auto login = std::make_shared<LoginDialog>();
  login->initSignals();  // æ­¤æ—¶ shared_from_this() æœ‰æ•ˆ
  ```

------

### 4. **æ€»ç»“**

- **å¼•ç”¨è®¡æ•°å½±å“**ï¼š
  - `weak_ptr`çš„èµ‹å€¼**ä¸å¢åŠ **å¼ºå¼•ç”¨è®¡æ•°ï¼Œä¸å½±å“å¯¹è±¡ç”Ÿå‘½å‘¨æœŸã€‚
- **å®‰å…¨æ€§**ï¼š
  - æ— å¾ªç¯å¼•ç”¨é£é™©ï¼ˆå¼ºå¼•ç”¨æ˜¯å•å‘çš„ï¼‰ã€‚
  - `weak_ptr`é¿å…æ‚¬ç©ºæŒ‡é’ˆï¼Œéœ€é€šè¿‡ `lock()`å®‰å…¨è®¿é—®ã€‚
- **æœ€ä½³å®è·µ**ï¼š
  - ç¡®ä¿å¯¹è±¡ç”± `shared_ptr`ç®¡ç†åå†è°ƒç”¨ `shared_from_this()`ã€‚
  - åœ¨ `RegisterDialog`ä¸­å§‹ç»ˆä½¿ç”¨ `lock()`æ£€æŸ¥å¼±æŒ‡é’ˆæœ‰æ•ˆæ€§ã€‚

æ‚¨çš„ä»£ç æ˜¯å®‰å…¨çš„ï¼Œç¬¦åˆæ™ºèƒ½æŒ‡é’ˆçš„è®¾è®¡æ„å›¾ã€‚

## ä¸»çª—å£ï¼Œçª—å£ï¼Œå¯¹è¯æ¡†

ä¸€å¥è¯å…ˆè®²ç»“è®ºï¼š  

> **é€‰é”™åŸºç±»ï¼Œä½ çš„çª—å£å°±â€œé•¿â€å¾—å®Œå…¨ä¸åƒä½ æƒ³è¦çš„â€”â€”èœå•æ ã€å·¥å…·æ ã€çŠ¶æ€æ ã€æ¨¡æ€/éæ¨¡æ€ã€ä»»åŠ¡æ å›¾æ ‡â€¦â€¦éƒ½ä¼šè·Ÿç€å˜ã€‚**

ä¸‹é¢æŠŠä¸‰ç§åŸºç±»åœ¨ Qt é‡Œçš„å®šä½å’Œå·®å¼‚ä¸€æ¬¡è¯´æ¸…ï¼Œæ–¹ä¾¿ä½ â€œå¯¹å·å…¥åº§â€ã€‚

---

### 1. QMainWindowï¼ˆâ€œ**ç¨‹åºä¸»çª—å£**â€ï¼‰

| ç‰¹å¾           | è¯´æ˜                                                         |
| -------------- | ------------------------------------------------------------ |
| **ç”¨é€”**       | å…¸å‹çš„å¤§ç¨‹åºä¸»ç•Œé¢ï¼ˆIDEã€æµè§ˆå™¨ã€Officeï¼‰ã€‚                  |
| **ç‹¬å åŠŸèƒ½**   | é¢„ç•™äº† **MenuBarã€ToolBarã€DockWidgetã€StatusBar** çš„åœé åŒºåŸŸï¼›è‡ªå¸¦å¸ƒå±€ç®¡ç†å™¨ `centralWidget()`ã€‚ |
| **å¤–è§‚**       | æœ‰æ ‡é¢˜æ ã€æœ€å°åŒ–/æœ€å¤§åŒ–æŒ‰é’®ã€ä»»åŠ¡æ å›¾æ ‡ã€å¯åœé å·¥å…·æ ã€‚      |
| **ç»§æ‰¿é“¾**     | `QMainWindow â†’ QWidget â†’ QObject`ï¼ˆæ²¡æœ‰ `QDialog` çš„æ¨¡æ€æœºåˆ¶ï¼‰ã€‚ |
| **ä¸èƒ½åšçš„äº‹** | ä¸èƒ½å˜æˆæ¨¡æ€ï¼ˆexecï¼‰ï¼Œä¹Ÿä¸èƒ½å½“å†…åµŒå­æ§ä»¶ã€‚                   |

ç¤ºä¾‹ï¼š  

```cpp
class MainWindow : public QMainWindow { â€¦ };
setCentralWidget(new QTextEdit(this));   // å¿…é¡»è®¾ç½®ä¸­å¿ƒæ§ä»¶
```

---

### 2. QWidgetï¼ˆâ€œ**æœ€æ™®é€šçš„çŸ©å½¢åŒºåŸŸ**â€ï¼‰

| ç‰¹å¾       | è¯´æ˜                                                         |
| ---------- | ------------------------------------------------------------ |
| **ç”¨é€”**   | ä»»ä½•è½»é‡çº§çŸ©å½¢åŒºï¼šå­æ§ä»¶ã€æ— è¾¹æ¡†æµ®åŠ¨çª—å£ã€å†…åµŒé¢æ¿ç­‰ã€‚       |
| **åŠŸèƒ½**   | åªæœ‰æœ€åŸºç¡€çš„çª—å£æ ‡å¿—ï¼ˆå¯å¼€å…³æ ‡é¢˜æ ã€è¾¹æ¡†ï¼‰ã€‚æ— èœå•/å·¥å…·æ æ¦‚å¿µã€‚ |
| **å¯å¡‘æ€§** | å¯ä»¥ `setWindowFlags(Qt::Window)` å˜æˆé¡¶å±‚çª—å£ï¼Œä¹Ÿå¯ä»¥ `new QWidget(parent)` å½“å­æ§ä»¶ã€‚ |
| **æ¨¡æ€**   | é»˜è®¤æ— æ¨¡æ€ï¼›æƒ³æ¨¡æ€éœ€æ‰‹åŠ¨ `setWindowModality()` + `show()`ï¼Œä½†æ•ˆæœä¸å¦‚ QDialog å¥½ã€‚ |

ç¤ºä¾‹ï¼š  

```cpp
class Panel : public QWidget { â€¦ };
setWindowFlags(Qt::Window | Qt::FramelessWindowHint);  // å˜æˆæ— è¾¹æ¡†æµ®åŠ¨çª—å£
```

---

### 3. QDialogï¼ˆâ€œ**å¯¹è¯æ¡†**â€ï¼‰

| ç‰¹å¾         | è¯´æ˜                                                         |
| ------------ | ------------------------------------------------------------ |
| **ç”¨é€”**     | æ¨¡æ€/éæ¨¡æ€å¯¹è¯æ¡†ã€è®¾ç½®é¢æ¿ã€æ¶ˆæ¯æ¡†ã€‚                        |
| **ç‹¬å åŠŸèƒ½** | æ”¯æŒ `exec()`ï¼ˆé˜»å¡å¼æ¨¡æ€è¿”å› `int` ç»“æœç ï¼‰ã€`accept()`/`reject()` æ§½ã€é»˜è®¤æŒ‰é’®æœºåˆ¶ã€‚ |
| **å¤–è§‚**     | æœ‰æ ‡é¢˜æ ã€å¯è®¾ç½® `?` å¸®åŠ©æŒ‰é’®ã€çª—å£å¯å›ºå®šå¤§å°ï¼›æ— èœå•/å·¥å…·æ åŒºåŸŸã€‚ |
| **ç»§æ‰¿é“¾**   | `QDialog â†’ QWidget â†’ QObject`ï¼ˆæ²¡æœ‰ QMainWindow çš„åœé åŒºåŸŸï¼‰ã€‚ |

ç¤ºä¾‹ï¼š  

```cpp
class LoginDlg : public QDialog {
    Q_OBJECT
public slots:
    void accept() override { if (check()) QDialog::accept(); }
};

LoginDlg dlg;
if (dlg.exec() == QDialog::Accepted) { â€¦ }
```

---

### 4. ä¸€å¼ è¡¨æ€»ç»“

| ç‰¹æ€§ / åŸºç±»        | QMainWindow | QWidget              | QDialog          |
| ------------------ | ----------- | -------------------- | ---------------- |
| èœå•/å·¥å…·æ /åœé åŒº | âœ… å†…ç½®      | âŒ æ—                  | âŒ æ—              |
| æ¨¡æ€ `exec()`      | âŒ ä¸æ”¯æŒ    | âŒ å¼±æ”¯æŒ             | âœ… å¼ºæ”¯æŒ         |
| ä»»åŠ¡æ å›¾æ ‡         | âœ… é»˜è®¤      | âœ…ï¼ˆè®¾ä¸ºé¡¶å±‚æ—¶ï¼‰      | âœ…                |
| å…¸å‹åœºæ™¯           | ä¸»ç¨‹åºçª—å£  | å­æ§ä»¶ã€æ— è¾¹æ¡†æµ®åŠ¨çª— | è®¾ç½®ã€ç™»å½•ã€å¼¹æ¡† |
| å¿…é¡» centralWidget | âœ…           | âŒ                    | âŒ                |

---

### 5. é€‰å“ªä¸ªï¼Ÿ

- **å†™ä¸»ç¨‹åº** â†’ `QMainWindow`  
- **å†™å¼¹æ¡†/è®¾ç½®çª—å£** â†’ `QDialog`  
- **å†™å†…éƒ¨é¢æ¿ã€è‡ªå®šä¹‰æ§ä»¶ã€æ— è¾¹æ¡†æµ®åŠ¨å·¥å…·çª—** â†’ `QWidget`

è®°ä½ä¸€å¥è¯ï¼š**â€œéœ€è¦èœå•æ  dock å°±ç”¨ QMainWindowï¼Œéœ€è¦å¯¹è¯æ¡†å°±ç”¨ QDialogï¼Œå…¶ä½™å…¨ç”¨ QWidgetã€‚â€**

## äº‹ä»¶æœºåˆ¶

å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†ã€æ·±å…¥åœ°è®²è§£ä¸€ä¸‹ Qt çš„äº‹ä»¶æœºåˆ¶ã€‚ç†è§£äº‹ä»¶æœºåˆ¶æ˜¯æŒæ¡ Qt ç¼–ç¨‹çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œå› ä¸ºå®ƒè´¯ç©¿äºæ•´ä¸ªåº”ç”¨ç¨‹åºçš„äº¤äº’å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

### ä¸€ã€æ ¸å¿ƒæ€æƒ³ï¼šäº‹ä»¶é©±åŠ¨ç¼–ç¨‹

Qt æ˜¯ä¸€ä¸ª**äº‹ä»¶é©±åŠ¨**çš„æ¡†æ¶ã€‚è¿™æ„å‘³ç€ï¼š

*   ç¨‹åºçš„æ‰§è¡Œæµä¸æ˜¯ç”±é¢„å…ˆå®šä¹‰çš„é¡ºåºå†³å®šçš„ï¼Œè€Œæ˜¯ç”±**äº‹ä»¶**çš„å‘ç”Ÿæ¥è§¦å‘çš„ã€‚
*   **äº‹ä»¶**æ˜¯å¯¹åº”ç”¨ç¨‹åºå†…éƒ¨æˆ–å¤–éƒ¨å‘ç”Ÿçš„å„ç§äº‹æƒ…çš„æè¿°ã€‚ä¾‹å¦‚ï¼šç”¨æˆ·ç‚¹å‡»é¼ æ ‡ã€æŒ‰ä¸‹é”®ç›˜ã€å®šæ—¶å™¨è¶…æ—¶ã€ç½‘ç»œæ•°æ®åˆ°è¾¾ã€çª—å£éœ€è¦é‡ç»˜ç­‰ã€‚
*   åº”ç”¨ç¨‹åºå¤§éƒ¨åˆ†æ—¶é—´éƒ½å¤„äº**äº‹ä»¶å¾ªç¯**ä¸­ï¼Œç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿï¼Œç„¶ååˆ†å‘äº‹ä»¶ï¼Œè°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¤„ç†å®Œæ¯•åç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªäº‹ä»¶ã€‚

---

### äºŒã€æ ¸å¿ƒç»„ä»¶ä¸æµç¨‹

Qt äº‹ä»¶æœºåˆ¶ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š

#### 1. äº‹ä»¶ (`QEvent`)

*   **æ˜¯ä»€ä¹ˆ**ï¼šæ‰€æœ‰äº‹ä»¶çš„åŸºç±»ã€‚å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€ä¸ªæšä¸¾ç±»å‹çš„ `type()` æ¥æ ‡è¯†äº‹ä»¶ç±»å‹ï¼ˆå¦‚ `QEvent::MouseButtonPress`, `QEvent::KeyPress`, `QEvent::Paint`ç­‰ï¼‰ï¼Œä»¥åŠä¸€äº›é¢å¤–çš„å‚æ•°ã€‚
*   **æ¥æº**ï¼š
    *   **è‡ªå‘äº‹ä»¶**ï¼šé€šå¸¸æ¥è‡ªçª—å£ç³»ç»Ÿï¼ˆå¦‚ X11, Windows, macOSï¼‰ï¼Œç”± `QApplication::notify()` æ¥æ”¶å¹¶è½¬åŒ–ä¸º Qt äº‹ä»¶ã€‚
    *   **ç²˜è´´äº‹ä»¶**ï¼šç”± Qt åº”ç”¨ç¨‹åºè‡ªèº«äº§ç”Ÿå¹¶æ’é˜Ÿï¼Œä¾‹å¦‚ `QTimerEvent`, `QFutureWatcher` å®Œæˆæ—¶äº§ç”Ÿçš„äº‹ä»¶ï¼Œæˆ–è€…é€šè¿‡ `QCoreApplication::postEvent()` å‘é€çš„è‡ªå®šä¹‰äº‹ä»¶ã€‚

#### 2. äº‹ä»¶å¾ªç¯ (`QEventLoop`)

*   **æ˜¯ä»€ä¹ˆ**ï¼šæ¯ä¸ª Qt åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒï¼Œå¯ä»¥çœ‹ä½œæ˜¯ `main()` å‡½æ•°ä¸­çš„ `return app.exec();`ã€‚è¿™è¡Œä»£ç å°±å¯åŠ¨äº†åº”ç”¨ç¨‹åºçš„ä¸»äº‹ä»¶å¾ªç¯ã€‚
*   **åšä»€ä¹ˆ**ï¼šäº‹ä»¶å¾ªç¯ä¸æ–­åœ°æ£€æŸ¥äº‹ä»¶é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ–°äº‹ä»¶ã€‚å¦‚æœæœ‰ï¼Œå®ƒå°±å–å‡ºä¸€ä¸ªäº‹ä»¶ï¼Œå°†å…¶è½¬åŒ–ä¸º `QEvent`ï¼Œç„¶åé€šè¿‡ `QCoreApplication::notify()` å°†å…¶å‘é€ç»™ç›®æ ‡å¯¹è±¡ (`QObject`)ã€‚
*   **å±‚æ¬¡ç»“æ„**ï¼šé™¤äº†ä¸»äº‹ä»¶å¾ªç¯ï¼Œè¿˜å¯ä»¥åˆ›å»ºå±€éƒ¨äº‹ä»¶å¾ªç¯ï¼ˆä¾‹å¦‚ï¼Œæ˜¾ç¤ºä¸€ä¸ªæ¨¡æ€å¯¹è¯æ¡†æ—¶ï¼Œä¼šå¯åŠ¨ä¸€ä¸ªå±€éƒ¨äº‹ä»¶å¾ªç¯æ¥é˜»å¡å½“å‰è°ƒç”¨ï¼Œä½†åˆä¸å½±å“ä¸»å¾ªç¯ï¼‰ã€‚

**ç®€åŒ–çš„å¾ªç¯ä¼ªä»£ç ï¼š**

```cpp
while (is_running) {
    // 1. æ£€æŸ¥äº‹ä»¶é˜Ÿåˆ—ï¼Œå¦‚æœæ²¡æœ‰äº‹ä»¶ï¼Œåˆ™è¿›å…¥ä¼‘çœ çŠ¶æ€ä»¥èŠ‚çœCPU
    if (!event_queue.hasEvent()) {
        wait_for_more_events();
    }

    // 2. ä»é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªäº‹ä»¶
    Event event = event_queue.nextEvent();

    // 3. åˆ†å‘äº‹ä»¶ï¼šæ‰¾åˆ°äº‹ä»¶çš„æ¥æ”¶è€…ï¼Œå¹¶è°ƒç”¨å…¶event()æ–¹æ³•
    dispatch_event(event);
}
```

#### 3. äº‹ä»¶æ¥æ”¶ä¸å¤„ç† (`QObject::event()`)

äº‹ä»¶æœ€ç»ˆä¼šè¢«å‘é€åˆ°ç‰¹å®šçš„ `QObject`ï¼ˆæˆ–å…¶å­ç±»ï¼Œå¦‚ `QWidget`ï¼‰ã€‚äº‹ä»¶å¤„ç†çš„å…¥å£æ˜¯ `QObject::event(QEvent *e)` è™šå‡½æ•°ã€‚

**æ ‡å‡†çš„äº‹ä»¶å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š**

1.  **`bool QObject::event(QEvent *e)`**ï¼š
    *   è¿™æ˜¯äº‹ä»¶å¤„ç†çš„æ€»å…¥å£ã€‚å®ƒæŸ¥çœ‹ `QEvent` çš„ç±»å‹ `e->type()`ã€‚
    *   å¯¹äºå¸¸è§çš„äº‹ä»¶ç±»å‹ï¼ˆå¦‚é”®ç›˜ã€é¼ æ ‡ï¼‰ï¼Œå®ƒä¼šè°ƒç”¨ä¸€ä¸ªæ›´æ–¹ä¾¿çš„**äº‹ä»¶å¤„ç†å™¨**ã€‚

2.  **ç‰¹å®šäº‹ä»¶å¤„ç†å™¨**ï¼š
    *   è¿™äº›æ˜¯ `QObject` æˆ– `QWidget` ä¸­å®šä¹‰çš„è™šå‡½æ•°ï¼Œä¸“é—¨å¤„ç†ç‰¹å®šç±»å‹çš„äº‹ä»¶ã€‚
    *   `event()` æ–¹æ³•ä¼šæ ¹æ®äº‹ä»¶ç±»å‹è°ƒç”¨ç›¸åº”çš„å¤„ç†å™¨ã€‚ä¾‹å¦‚ï¼š
        *   `e->type() == QEvent::KeyPress` -> è°ƒç”¨ `keyPressEvent(QKeyEvent *e)`
        *   `e->type() == QEvent::MouseButtonPress` -> è°ƒç”¨ `mousePressEvent(QMouseEvent *e)`
        *   `e->type() == QEvent::Paint` -> è°ƒç”¨ `paintEvent(QPaintEvent *e)`

3.  **é»˜è®¤å®ç°**ï¼š
    *   åŸºç±»ï¼ˆå¦‚ `QWidget`ï¼‰çš„äº‹ä»¶å¤„ç†å™¨é€šå¸¸æœ‰ä¸€ä¸ªé»˜è®¤çš„å®ç°ã€‚ä¾‹å¦‚ï¼Œ`QWidget::keyPressEvent()` é»˜è®¤ä»€ä¹ˆä¹Ÿä¸åšã€‚
    *   **å¦‚æœä½ æƒ³è¦å¤„ç†æŸä¸ªäº‹ä»¶ï¼Œä½ åº”è¯¥åœ¨ä½ çš„å­ç±»ä¸­é‡å†™å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼Œè€Œä¸æ˜¯ `event()` å‡½æ•°**ã€‚è¿™æ˜¯æœ€å¸¸è§çš„æ–¹å¼ã€‚

---

### ä¸‰ã€äº‹ä»¶ä¼ é€’çš„è·¯å¾„ï¼šæ·±å…¥ `notify()` å’Œ `event()`

äº‹ä»¶çš„å®Œæ•´æ—…ç¨‹æ›´åŠ ç²¾ç»†ï¼š

1.  `QApplication::notify(receiver, event)`ï¼š è¿™æ˜¯Qtäº‹ä»¶é“¾çš„**æœ€é¡¶å±‚**ã€‚å®ƒè´Ÿè´£å°†äº‹ä»¶å‘é€ç»™ç‰¹å®šçš„æ¥æ”¶è€…å¯¹è±¡ã€‚åœ¨æŸäº›éå¸¸ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚éœ€è¦å…¨å±€ç›‘æ§æ‰€æœ‰äº‹ä»¶ï¼‰ï¼Œä½ å¯ä»¥å­ç±»åŒ– `QApplication` å¹¶é‡å†™è¿™ä¸ªå‡½æ•°ï¼Œä½†è¿™é€šå¸¸ä¸æ¨èã€‚

2.  **äº‹ä»¶è¿‡æ»¤å™¨**ï¼šåœ¨ `notify()` åˆ†å‘äº‹ä»¶ä¹‹å‰ï¼Œä¼šå…ˆæ£€æŸ¥æ¥æ”¶è€…å¯¹è±¡åŠå…¶çˆ¶å¯¹è±¡æ˜¯å¦å®‰è£…äº†**äº‹ä»¶è¿‡æ»¤å™¨**ã€‚è¿™æ˜¯äº‹ä»¶æœºåˆ¶ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§å’Œæœ‰ç”¨çš„ç‰¹æ€§ã€‚
    *   ä¸€ä¸ªå¯¹è±¡å¯ä»¥ç›‘å¬å¦ä¸€ä¸ªå¯¹è±¡çš„äº‹ä»¶ã€‚
    *   å¦‚æœäº‹ä»¶è¿‡æ»¤å™¨è¿”å› `true`ï¼Œè¡¨ç¤ºäº‹ä»¶å·²è¢«å¤„ç†ï¼Œä¸ä¼šå†ç»§ç»­ä¼ é€’ï¼ˆå³ä¸ä¼šè°ƒç”¨ç›®æ ‡çš„ `event()` å‡½æ•°ï¼‰ã€‚
    *   å¦‚æœè¿”å› `false`ï¼Œäº‹ä»¶ä¼šç»§ç»­ä¼ é€’åˆ°ç›®æ ‡å¯¹è±¡çš„ `event()` å‡½æ•°ã€‚

3.  `QObject::event(QEvent *e)`ï¼š å¦‚ä¸Šæ‰€è¿°ï¼Œäº‹ä»¶åˆ°è¾¾æ¥æ”¶å¯¹è±¡ã€‚

4.  **ç‰¹å®šäº‹ä»¶å¤„ç†å™¨**ï¼š`event()` å‡½æ•°è°ƒç”¨å¯¹åº”çš„ç‰¹å®šäº‹ä»¶å¤„ç†å™¨ï¼ˆå¦‚ `keyPressEvent`ï¼‰ã€‚

5.  **ä¿¡å·ä¸æ§½**ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›äº‹ä»¶å¤„ç†å™¨ä¼š**å‘å°„ä¿¡å·**ã€‚ä¾‹å¦‚ï¼Œ`QAbstractButton` çš„ `mousePressEvent()` ä¼šå¤„ç†é¼ æ ‡ç‚¹å‡»ï¼Œç„¶åå‘å°„ `clicked()` ä¿¡å·ã€‚è¿™æ˜¯äº‹ä»¶æœºåˆ¶ä¸ä¿¡å·æ§½æœºåˆ¶è¿æ¥çš„åœ°æ–¹ã€‚

**äº‹ä»¶ä¼ é€’è·¯å¾„æ€»ç»“ï¼š**
`è‡ªå‘äº‹ä»¶` -> `QApplication::notify()` -> `(äº‹ä»¶è¿‡æ»¤å™¨)` -> `æ¥æ”¶è€…QObject::event()` -> `æ¥æ”¶è€…ç‰¹å®šäº‹ä»¶å¤„ç†å™¨(å¦‚keyPressEvent)` -> `å¯èƒ½è§¦å‘ä¿¡å·` -> `è¿æ¥åˆ°ä¿¡å·çš„æ§½å‡½æ•°`

---

### å››ã€äº‹ä»¶çš„ç±»å‹ä¸å¤„ç†æ–¹å¼

#### 1. åŒæ­¥ vs. å¼‚æ­¥äº‹ä»¶

*   **åŒæ­¥äº‹ä»¶**ï¼šé€šè¿‡ `sendEvent()` å‘é€ã€‚äº‹ä»¶ä¼š**ç«‹å³**è¢«å¤„ç†ï¼Œå‡½æ•°ä¼šé˜»å¡ç›´åˆ°äº‹ä»¶å¤„ç†å®Œæˆã€‚`sendEvent()` æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
*   **å¼‚æ­¥äº‹ä»¶**ï¼šé€šè¿‡ `postEvent()` å‘é€ã€‚äº‹ä»¶è¢«æ·»åŠ åˆ°æ¥æ”¶è€…å¯¹è±¡æ‰€åœ¨çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…äº‹ä»¶å¾ªç¯ç¨åå¤„ç†ã€‚å‡½æ•°è°ƒç”¨ç«‹å³è¿”å›ã€‚`postEvent()` æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¸¸ç”¨äºè·¨çº¿ç¨‹é€šä¿¡ã€‚

#### 2. äº‹ä»¶ä¼ æ’­ï¼šAccept å’Œ Ignore

æ¯ä¸ª `QEvent` éƒ½æœ‰ä¸€ä¸ª `accept()` å’Œ `ignore()` æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ª `isAccepted()` æ ‡å¿—ã€‚

*   è¿™ä¸ªæ ‡å¿—å†³å®šäº†äº‹ä»¶åœ¨**å±‚æ¬¡ç»“æ„**ä¸­æ˜¯å¦ç»§ç»­ä¼ æ’­ã€‚
*   é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶æ˜¯è¢«æ¥å—çš„ï¼ˆ`accept()`ï¼‰ï¼Œæ„å‘³ç€â€œè¿™ä¸ªäº‹ä»¶æˆ‘å¤„ç†äº†ï¼Œä¸ç”¨å†ç»™åˆ«äººäº†â€ã€‚
*   ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¯¹è¯æ¡†ä¸­ï¼Œä½ ç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®ã€‚æŒ‰é’®çš„ `mousePressEvent` æ¥å—äº†è¯¥äº‹ä»¶ï¼Œå¤„ç†äº†ç‚¹å‡»ã€‚äº‹ä»¶å°±ä¸ä¼šå†ä¼ æ’­ç»™æŒ‰é’®çš„çˆ¶ç»„ä»¶ï¼ˆå¯¹è¯æ¡†ï¼‰ã€‚å¦‚æœä½ åœ¨æŒ‰é’®çš„äº‹ä»¶å¤„ç†å™¨ä¸­è°ƒç”¨ `ignore()`ï¼Œé‚£ä¹ˆäº‹ä»¶ä¼šç»§ç»­å‘ä¸Šä¼ é€’ç»™å®ƒçš„çˆ¶ç»„ä»¶ã€‚

**æ³¨æ„**ï¼šè¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨äºä¸€äº›ç‰¹å®šçš„äº‹ä»¶ç±»å‹ï¼Œå¦‚çª—å£å…³é—­äº‹ä»¶ (`QCloseEvent`)ã€‚

---

### äº”ã€å¦‚ä½•ä¸äº‹ä»¶æœºåˆ¶äº¤äº’

1. **é‡å†™äº‹ä»¶å¤„ç†å™¨**ï¼šæœ€å¸¸ç”¨ã€æœ€æ¨èçš„æ–¹å¼ã€‚

   ```cpp
   class MyWidget : public QWidget {
       Q_OBJECT
   protected:
       void keyPressEvent(QKeyEvent *e) override {
           if (e->key() == Qt::Key_Space) {
               qDebug() << "Space pressed!";
               // å¤„ç†äº†ï¼Œäº‹ä»¶åˆ°æ­¤ä¸ºæ­¢
               e->accept();
           } else {
               // è®©åŸºç±»å¤„ç†å…¶ä»–æŒ‰é”®
               QWidget::keyPressEvent(e);
           }
       }
   
       void paintEvent(QPaintEvent *e) override {
           QPainter painter(this);
           painter.drawText(rect(), "Hello, Event!");
           // paintEvent å¿…é¡»æ€»æ˜¯è¢«å¤„ç†ï¼Œé€šå¸¸ä¸éœ€è¦è°ƒç”¨åŸºç±»ï¼Œä½†å–å†³äºéœ€æ±‚
       }
   };
   ```

2. **å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨**ï¼šç›‘å¬å…¶ä»–å¯¹è±¡çš„äº‹ä»¶ã€‚

   ```cpp
   class FilterObject : public QObject {
       Q_OBJECT
   protected:
       bool eventFilter(QObject *watched, QEvent *event) override {
           if (event->type() == QEvent::KeyPress) {
               QKeyEvent *keyEvent = static_cast<QKeyEvent *>(event);
               qDebug() << "Filtered key press:" << keyEvent->key();
               // return true; // åƒæ‰è¿™ä¸ªäº‹ä»¶
               // return false; // ç»§ç»­ä¼ é€’
           }
           return QObject::eventFilter(watched, event); // è®©åŸºç±»å¤„ç†
       }
   };
   
   // åœ¨ä½¿ç”¨çš„åœ°æ–¹
   MyWidget widget;
   FilterObject filter;
   widget.installEventFilter(&filter); // è®©filterç›‘å¬widgetçš„äº‹ä»¶
   ```

3. **å‘é€è‡ªå®šä¹‰äº‹ä»¶**ï¼šä½ å¯ä»¥å­ç±»åŒ– `QEvent`ï¼Œåˆ›å»ºè‡ªå·±çš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä½¿ç”¨ `postEvent()` æˆ– `sendEvent()` æ¥å‘é€å®ƒä»¬ã€‚

   ```cpp
   // 1. å®šä¹‰è‡ªå®šä¹‰äº‹ä»¶ç±»å‹ï¼ˆå¿…é¡»å¤§äº QEvent::Userï¼‰
   const QEvent::Type MyCustomEventType = static_cast<QEvent::Type>(QEvent::User + 1);
   
   // 2. å­ç±»åŒ–QEventï¼ˆå¯é€‰ï¼Œç”¨äºæºå¸¦æ•°æ®ï¼‰
   class CustomEvent : public QEvent {
   public:
       CustomEvent(const QString &data) : QEvent(MyCustomEventType), m_data(data) {}
       QString data() const { return m_data; }
   private:
       QString m_data;
   };
   
   // 3. åœ¨æ¥æ”¶è€…ä¸­é‡å†™ event() å‡½æ•°æ¥å¤„ç†è‡ªå®šä¹‰äº‹ä»¶
   bool MyWidget::event(QEvent *e) {
       if (e->type() == MyCustomEventType) {
           CustomEvent *ce = static_cast<CustomEvent *>(e);
           qDebug() << "Custom event received:" << ce->data();
           return true; // å·²å¤„ç†
       }
       return QWidget::event(e); // è®©åŸºç±»å¤„ç†å…¶ä»–äº‹ä»¶
   }
   
   // 4. åœ¨æŸä¸ªåœ°æ–¹å‘é€äº‹ä»¶
   QCoreApplication::postEvent(&receiver_object, new CustomEvent("Hello!"));
   ```

---

### å…­ã€äº‹ä»¶æœºåˆ¶ä¸ä¿¡å·æ§½æœºåˆ¶çš„å…³ç³»

è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„å›°æƒ‘ç‚¹ã€‚

| ç‰¹æ€§         | äº‹ä»¶æœºåˆ¶                                                     | ä¿¡å·æ§½æœºåˆ¶                                                 |
| :----------- | :----------------------------------------------------------- | :--------------------------------------------------------- |
| **é€šä¿¡èŒƒå›´** | **çºµå‘**çš„ï¼Œä»çˆ¶ç»„ä»¶åˆ°å­ç»„ä»¶ï¼Œæˆ–è€…é€šè¿‡äº‹ä»¶è¿‡æ»¤å™¨ã€‚           | **ä»»æ„**çš„ï¼Œå¯ä»¥åœ¨ä»»ä½•QObjectä¹‹é—´è¿æ¥ï¼Œå…³ç³»æ˜¯å¹³è¡Œçš„ã€‚      |
| **ç´§è€¦åˆåº¦** | **ç´§è€¦åˆ**ã€‚å‘é€è€…å¿…é¡»çŸ¥é“æ¥æ”¶è€…æ˜¯è°ï¼ˆ`QObject*`ï¼‰ã€‚         | **æ¾è€¦åˆ**ã€‚å‘é€è€…ä¸çŸ¥é“æ¥æ”¶è€…æ˜¯è°ï¼Œåªéœ€è¦çŸ¥é“ä¿¡å·çš„ç­¾åã€‚ |
| **ç”¨é€”**     | **åº•å±‚äº¤äº’**ï¼šå¤„ç†æ¥è‡ªæ“ä½œç³»ç»Ÿçš„åŸå§‹äº‹ä»¶ï¼ˆè¾“å…¥ã€ç»˜åˆ¶ç­‰ï¼‰ã€å¯¹è±¡å†…éƒ¨çŠ¶æ€ç®¡ç†ã€ä¸­æ–­å¤„ç†ã€‚ | **é«˜å±‚é€»è¾‘**ï¼šå“åº”UIæ“ä½œã€åœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’ä¸šåŠ¡é€»è¾‘çŠ¶æ€å˜åŒ–ã€‚ |
| **æ•ˆç‡**     | é€šå¸¸**æ›´é«˜**ï¼Œå› ä¸ºæ˜¯ç›´æ¥çš„å‡½æ•°è°ƒç”¨ã€‚                         | ç•¥æœ‰å¼€é”€ï¼ˆæŸ¥æ‰¾è¿æ¥ã€å‚æ•°æ‹·è´ï¼‰ï¼Œä½†é€šå¸¸å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚       |

**è”ç³»**ï¼šä¿¡å·æ§½æœºåˆ¶æ„å»ºåœ¨äº‹ä»¶æœºåˆ¶ä¹‹ä¸Šã€‚ä¸€ä¸ªäº‹ä»¶ï¼ˆå¦‚é¼ æ ‡ç‚¹å‡»ï¼‰æœ€ç»ˆå¯èƒ½è§¦å‘ä¸€ä¸ªä¿¡å·ï¼ˆå¦‚ `clicked()`ï¼‰ã€‚

---

### æ€»ç»“

Qt çš„äº‹ä»¶æœºåˆ¶æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„ä½“ç³»ï¼Œå…¶æ ¸å¿ƒæ˜¯ **â€œäº‹ä»¶å¾ªç¯ -> äº‹ä»¶åˆ†å‘ -> äº‹ä»¶å¤„ç†â€** æ¨¡å‹ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œä½ æœ€å¸¸åšçš„æ˜¯ï¼š

1.  **é‡å†™ç‰¹å®šäº‹ä»¶å¤„ç†å™¨**ï¼ˆå¦‚ `paintEvent`, `keyPressEvent`) æ¥å¤„ç†äº¤äº’å’Œç»˜åˆ¶ã€‚
2.  ä½¿ç”¨**äº‹ä»¶è¿‡æ»¤å™¨**æ¥ç›‘å¬æˆ–æ‹¦æˆªå…¶ä»–å¯¹è±¡çš„äº‹ä»¶ã€‚
3.  åœ¨éœ€è¦æ—¶ä½¿ç”¨ `postEvent()` è¿›è¡Œ**çº¿ç¨‹é—´é€šä¿¡**æˆ–å‘é€è‡ªå®šä¹‰äº‹ä»¶ã€‚

ç†è§£è¿™ä¸ªæœºåˆ¶ï¼Œä½ å°±èƒ½æ›´æ·±å…¥åœ°æŒæ§ Qt åº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œç¼–å†™å‡ºå“åº”çµæ•ã€æ•ˆç‡é«˜çš„ç¨‹åºã€‚

## Qtä¸­connectå‡½æ•°çš„ç”¨æ³•è¯¦è§£

åœ¨Qtæ¡†æ¶ä¸­ï¼Œ`connect`å‡½æ•°æ˜¯å®ç°ä¿¡å·ä¸æ§½æœºåˆ¶çš„æ ¸å¿ƒï¼Œç”¨äºåœ¨å¯¹è±¡ä¹‹é—´å»ºç«‹é€šä¿¡è¿æ¥ã€‚ä¸‹é¢æˆ‘å°†è¯¦ç»†è®²è§£å…¶ç”¨æ³•ã€‚

### åŸºæœ¬è¯­æ³•

```cpp
QMetaObject::Connection QObject::connect(
    const QObject *sender, 
    const char *signal, 
    const QObject *receiver, 
    const char *method, 
    Qt::ConnectionType type = Qt::AutoConnection
)
```

### å‚æ•°è¯´æ˜

1. **sender**: å‘å‡ºä¿¡å·çš„å¯¹è±¡æŒ‡é’ˆ
2. **signal**: ä¿¡å·çš„ç­¾åï¼Œä½¿ç”¨SIGNAL()å®
3. **receiver**: æ¥æ”¶ä¿¡å·çš„å¯¹è±¡æŒ‡é’ˆ
4. **method**: æ§½å‡½æ•°çš„ç­¾åï¼Œä½¿ç”¨SLOT()å®
5. **type**: è¿æ¥ç±»å‹ï¼Œå†³å®šä¿¡å·å¦‚ä½•ä¼ é€’åˆ°æ§½

### è¿æ¥ç±»å‹

- `Qt::AutoConnection` (é»˜è®¤): è‡ªåŠ¨é€‰æ‹©ç›´æ¥æˆ–é˜Ÿåˆ—è¿æ¥
- `Qt::DirectConnection`: ä¿¡å·å‘å‡ºæ—¶ç«‹å³è°ƒç”¨æ§½
- `Qt::QueuedConnection`: æ§½åœ¨æ¥æ”¶è€…çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä¸­è°ƒç”¨
- `Qt::BlockingQueuedConnection`: ç±»ä¼¼é˜Ÿåˆ—è¿æ¥ï¼Œä½†å‘é€è€…ä¼šé˜»å¡ç›´åˆ°æ§½æ‰§è¡Œå®Œæˆ
- `Qt::UniqueConnection`: é˜²æ­¢é‡å¤è¿æ¥åŒä¸€ä¿¡å·å’Œæ§½

### Qt4ä¸Qt5è¯­æ³•å¯¹æ¯”

### Qt4ä¼ ç»Ÿè¯­æ³•

```cpp
// ä¼ ç»Ÿè¯­æ³•(ä¸æ¨èåœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨)
connect(button, SIGNAL(clicked()), this, SLOT(handleButton()));
```

### Qt5æ–°è¯­æ³•(æ¨è)

```cpp
// æ–°è¯­æ³• - ç¼–è¯‘æ—¶æ£€æŸ¥
connect(button, &QPushButton::clicked, this, &MyClass::handleButton);
```

### å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºæœ¬ä¿¡å·æ§½è¿æ¥

```cpp
// è¿æ¥æŒ‰é’®ç‚¹å‡»ä¿¡å·åˆ°æ§½å‡½æ•°
connect(ui->pushButton, &QPushButton::clicked, this, &MainWindow::onButtonClicked);

// å¯¹åº”çš„æ§½å‡½æ•°
void MainWindow::onButtonClicked()
{
    qDebug() << "Button clicked!";
}
```

### ç¤ºä¾‹2: ä½¿ç”¨Lambdaè¡¨è¾¾å¼

```cpp
// ä½¿ç”¨Lambdaè¡¨è¾¾å¼ä½œä¸ºæ§½
connect(ui->pushButton, &QPushButton::clicked, [this]() {
    qDebug() << "Button clicked from lambda!";
    this->doSomething();
});
```

### ç¤ºä¾‹3: å¸¦å‚æ•°çš„ä¿¡å·æ§½

```cpp
// ä¿¡å·å’Œæ§½éƒ½æœ‰å‚æ•°
connect(slider, &QSlider::valueChanged, spinBox, &QSpinBox::setValue);

// æˆ–è€…ä½¿ç”¨Lambdaå¤„ç†å‚æ•°
connect(slider, &QSlider::valueChanged, [this](int value) {
    qDebug() << "Slider value:" << value;
});
```

### ç¤ºä¾‹4: è¿æ¥ä¸åŒçº¿ç¨‹çš„å¯¹è±¡

```cpp
// è·¨çº¿ç¨‹è¿æ¥ï¼Œä½¿ç”¨é˜Ÿåˆ—è¿æ¥æ–¹å¼
connect(worker, &Worker::resultReady, this, &MainWindow::handleResult, Qt::QueuedConnection);
```

### ç¤ºä¾‹5: è‡ªåŠ¨æ–­å¼€è¿æ¥

```cpp
// ä½¿ç”¨QMetaObject::Connectionç®¡ç†è¿æ¥
QMetaObject::Connection connection = connect(...);

// éœ€è¦æ—¶æ–­å¼€è¿æ¥
disconnect(connection);
```

### æ–°å¼è¯­æ³•ä¼˜åŠ¿

1. **ç¼–è¯‘æ—¶æ£€æŸ¥**: æ–°è¯­æ³•åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ä¿¡å·å’Œæ§½çš„å­˜åœ¨æ€§å’Œå…¼å®¹æ€§
2. **ç±»å‹å®‰å…¨**: æä¾›æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§
3. **æ”¯æŒé‡è½½**: å¯ä»¥æ˜ç¡®æŒ‡å®šä½¿ç”¨å“ªä¸ªé‡è½½ç‰ˆæœ¬
4. **æ€§èƒ½æ›´å¥½**: ä¸éœ€è¦è¿è¡Œæ—¶å­—ç¬¦ä¸²æŸ¥æ‰¾

### å¤„ç†é‡è½½ä¿¡å·

å½“ä¿¡å·æœ‰é‡è½½æ—¶ï¼Œéœ€è¦ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæ˜ç¡®æŒ‡å®šï¼š

```cpp
// æ˜ç¡®æŒ‡å®šä½¿ç”¨å“ªä¸ªé‡è½½ç‰ˆæœ¬
connect(button, static_cast<void(QPushButton::*)(bool)>(&QPushButton::clicked),
        this, &MainWindow::handleButtonClicked);
```

### æ³¨æ„äº‹é¡¹

1. ç¡®ä¿å‘é€è€…å’Œæ¥æ”¶è€…éƒ½æ˜¯QObjectçš„æ´¾ç”Ÿç±»
2. åœ¨æ¥æ”¶è€…è¢«åˆ é™¤å‰æ–­å¼€è¿æ¥ï¼Œæˆ–ä½¿ç”¨Qt::UniqueConnection
3. è·¨çº¿ç¨‹è¿æ¥æ—¶æ³¨æ„çº¿ç¨‹å®‰å…¨æ€§
4. ä½¿ç”¨æ–°å¼è¯­æ³•æ—¶ï¼Œæ§½å‡½æ•°ä¸éœ€è¦åœ¨ç±»å£°æ˜ä¸­ä½¿ç”¨slotså…³é”®å­—

### æ€»ç»“

Qtçš„connectå‡½æ•°æä¾›äº†çµæ´»çš„å¯¹è±¡é—´é€šä¿¡æœºåˆ¶ã€‚æ¨èä½¿ç”¨Qt5çš„æ–°å¼è¯­æ³•ï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œç¼–è¯‘æ—¶æ£€æŸ¥ã€‚æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„è¿æ¥ç±»å‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­è¦æ³¨æ„çº¿ç¨‹å®‰å…¨æ€§ã€‚

## QT MVCæ¡†æ¶

Qt ä¸­çš„ MVCï¼ˆModel-View-Controllerï¼‰æ¡†æ¶æ›´å‡†ç¡®åœ°è¢«ç§°ä¸º**æ¨¡å‹/è§†å›¾æ¶æ„ï¼ˆModel/View Architectureï¼‰** ğŸ¨ã€‚å®ƒå°†æ•°æ®å’Œå…¶å‘ˆç°æ–¹å¼åˆ†ç¦»ï¼Œä½¿å¾—å¼€å‘æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚è¿™ä¸ªæ¶æ„ä¸»è¦åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

*   **æ¨¡å‹ (Model)**ï¼šè´Ÿè´£ç®¡ç†æ•°æ®ã€‚
*   **è§†å›¾ (View)**ï¼šè´Ÿè´£æ˜¾ç¤ºæ•°æ®ã€‚
*   **ä»£ç† (Delegate)**ï¼šåœ¨ Qt çš„æ¨¡å‹/è§†å›¾æ¶æ„ä¸­ï¼Œä¼ ç»Ÿçš„â€œæ§åˆ¶å™¨â€åŠŸèƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šç”±**ä»£ç† (Delegate)** å’Œè§†å›¾å…±åŒå¤„ç†ã€‚ä»£ç†ä¸»è¦è´Ÿè´£æ¸²æŸ“å’Œç¼–è¾‘æ•°æ®é¡¹ã€‚

ä¸ºäº†å¸®ä½ å¿«é€ŸæŠŠæ¡ Qt MVC çš„æ ¸å¿ƒç»„æˆã€èŒè´£å’Œäº¤äº’æ–¹å¼ï¼Œæˆ‘ç”¨ä¸€ä¸ªè¡¨æ ¼æ¥æ€»ç»“ï¼š

| ç»„ä»¶ (Component)    | èŒè´£ (Responsibility)                                | å¸¸ç”¨ç±» (Common Classes)                                      | äº¤äº’æ–¹å¼ (Interaction)                           |
| :------------------ | :--------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------- |
| **æ¨¡å‹ (Model)**    | ç®¡ç†æ•°æ®æºã€æä¾›æ•°æ®è®¿é—®æ¥å£ã€é€šçŸ¥è§†å›¾æ•°æ®å˜æ›´       | `QAbstractItemModel`, `QStandardItemModel`, `QStringListModel` | é€šè¿‡ä¿¡å·(`dataChanged`)é€šçŸ¥è§†å›¾å’Œä»£ç†            |
| **è§†å›¾ (View)**     | å¯è§†åŒ–å±•ç¤ºæ¨¡å‹æ•°æ®ã€å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆé€‰æ‹©ã€æ»šåŠ¨ç­‰ï¼‰     | `QListView`, `QTableView`, `QTreeView`                       | ä»æ¨¡å‹è·å–æ•°æ®ï¼›é€šè¿‡ä»£ç†æ¸²æŸ“å’Œç¼–è¾‘ï¼›æ¥æ”¶ç”¨æˆ·è¾“å…¥ |
| **ä»£ç† (Delegate)** | æ§åˆ¶æ•°æ®é¡¹çš„æ¸²æŸ“æ–¹å¼å’Œç¼–è¾‘å™¨ï¼ˆåˆ›å»ºå’Œç®¡ç†ç¼–è¾‘å™¨éƒ¨ä»¶ï¼‰ | `QAbstractItemDelegate`, `QStyledItemDelegate`               | å—è§†å›¾å§”æ‰˜è¿›è¡Œç»˜åˆ¶å’Œç¼–è¾‘ï¼›ç›´æ¥ä¸æ¨¡å‹é€šä¿¡æäº¤æ•°æ® |

ä¸‹é¢æ˜¯ä½¿ç”¨ `QTableView` å’Œ `QStandardItemModel` çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š

```cpp
#include <QtWidgets>

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    // åˆ›å»ºæ•°æ®æ¨¡å‹ (Model) - è´Ÿè´£ç®¡ç†æ•°æ®
    QStandardItemModel model(4, 3); // 4è¡Œ3åˆ—

    // è®¾ç½®æ°´å¹³è¡¨å¤´æ ‡ç­¾
    model.setHorizontalHeaderLabels({"Name", "Age", "Department"});

    // å¡«å……æ•°æ®
    model.setItem(0, 0, new QStandardItem("Zhang San"));
    model.setItem(0, 1, new QStandardItem("28"));
    model.setItem(0, 2, new QStandardItem("R&D"));
    
    model.setItem(1, 0, new QStandardItem("Li Si"));
    model.setItem(1, 1, new QStandardItem("32"));
    model.setItem(1, 2, new QStandardItem("Marketing"));
    
    model.setItem(2, 0, new QStandardItem("Wang Wu"));
    model.setItem(2, 1, new QStandardItem("24"));
    model.setItem(2, 2, new QStandardItem("Intern"));
    
    model.setItem(3, 0, new QStandardItem("Zhao Liu"));
    model.setItem(3, 1, new QStandardItem("45"));
    model.setItem(3, 2, new QStandardItem("Management"));

    // åˆ›å»ºè¡¨æ ¼è§†å›¾ (View) - è´Ÿè´£æ˜¾ç¤ºæ•°æ®
    QTableView tableView;
    // ä¸ºè§†å›¾è®¾ç½®æ¨¡å‹
    tableView.setModel(&model);
    // è®¾ç½®ä¸€äº›è§†å›¾å±æ€§ä»¥å¢å¼ºæ˜¾ç¤ºæ•ˆæœ
    tableView.resize(500, 200);
    tableView.setSelectionBehavior(QAbstractItemView::SelectRows); // æ•´è¡Œé€‰æ‹©
    tableView.horizontalHeader()->setSectionResizeMode(QHeaderView::Stretch); // æ‹‰ä¼¸åˆ—å®½
    tableView.show();

    return app.exec();
}
```

ğŸ› ï¸ **ä»£ç è§£é‡Š**ï¼š

*   **æ¨¡å‹ (`QStandardItemModel`)**ï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª 4 è¡Œ 3 åˆ—çš„æ¨¡å‹ï¼Œå¹¶å¡«å……äº†æ•°æ®å’Œè¡¨å¤´ã€‚`QStandardItemModel` æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ç±»ï¼Œé€‚ç”¨äºç®€å•çš„è¡¨æ ¼ã€åˆ—è¡¨å’Œæ ‘å½¢ç»“æ„æ•°æ®ã€‚
*   **è§†å›¾ (`QTableView`)**ï¼šæˆ‘ä»¬å°†åˆ›å»ºå¥½çš„æ¨¡å‹è®¾ç½®åˆ°è§†å›¾ä¸­ (`tableView.setModel(&model)`)ã€‚è§†å›¾ä¼šè‡ªåŠ¨ä»æ¨¡å‹è·å–æ•°æ®å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æˆ‘ä»¬é€šè¿‡è§†å›¾çš„ä¸€äº›æ–¹æ³•è®¾ç½®äº†é€‰æ‹©è¡Œä¸ºå’Œåˆ—å®½æ¨¡å¼ï¼Œè¿™äº›åªå½±å“æ˜¾ç¤ºæ•ˆæœï¼Œä¸æ”¹å˜åº•å±‚æ•°æ®ã€‚
*   **éšå¼çš„ä»£ç†**ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼åœ°åˆ›å»ºä»£ç†ï¼Œ`QTableView` ä¼šä½¿ç”¨é»˜è®¤çš„ `QStyledItemDelegate` æ¥å¤„ç†æ¯ä¸ªå•å…ƒæ ¼çš„ç»˜åˆ¶å’Œç¼–è¾‘ï¼ˆä½ å¯ä»¥å°è¯•åœ¨è¿è¡ŒååŒå‡»å•å…ƒæ ¼è¿›è¡Œç¼–è¾‘ï¼‰ã€‚

### ğŸ”§ è‡ªå®šä¹‰ä»£ç† (Custom Delegate)

è™½ç„¶ Qt æä¾›äº†é»˜è®¤çš„ä»£ç†ï¼Œä½†å½“ä½ æœ‰ç‰¹æ®Šçš„æ•°æ®æ˜¾ç¤ºæˆ–ç¼–è¾‘éœ€æ±‚æ—¶ï¼ˆæ¯”å¦‚åœ¨å•å…ƒæ ¼ä¸­æ˜¾ç¤ºè¿›åº¦æ¡ã€é¢œè‰²é€‰æ‹©å™¨ã€è‡ªå®šä¹‰æŒ‰é’®ç­‰ï¼‰ï¼Œå°±éœ€è¦è‡ªå®šä¹‰ä»£ç†ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰ä»£ç†ä¾‹å­ï¼Œå®ƒæ”¹å˜ç‰¹å®šå•å…ƒæ ¼çš„èƒŒæ™¯è‰²ï¼š

```cpp
#include <QtWidgets>

class HighlightDelegate : public QStyledItemDelegate
{
public:
    HighlightDelegate(QObject *parent = nullptr) : QStyledItemDelegate(parent) {}

    // é‡å†™ paint æ–¹æ³•æ¥è‡ªå®šä¹‰ç»˜åˆ¶
    void paint(QPainter *painter, const QStyleOptionViewItem &option, const QModelIndex &index) const override
    {
        // å¦‚æœå¹´é¾„å¤§äº30ï¼Œé«˜äº®æ˜¾ç¤ºè¯¥è¡Œ
        if (index.column() == 1) { // å‡è®¾ç¬¬äºŒåˆ—æ˜¯å¹´é¾„
            bool ok;
            int age = index.data(Qt::DisplayRole).toInt(&ok);
            if (ok && age > 30) {
                // åˆ›å»ºä¸€ä¸ªé«˜äº®çš„èƒŒæ™¯ç”»åˆ·
                painter->fillRect(option.rect, QBrush(QColor(255, 200, 200))); // æµ…çº¢è‰²èƒŒæ™¯
            }
        }
        // è°ƒç”¨åŸºç±»çš„ paint æ–¹æ³•å®Œæˆé»˜è®¤çš„æ–‡æœ¬ç»˜åˆ¶ç­‰æ“ä½œ
        QStyledItemDelegate::paint(painter, option, index);
    }
};

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    QStandardItemModel model(4, 3);
    model.setHorizontalHeaderLabels({"Name", "Age", "Department"});
    // ... (å¡«å……æ•°æ®åŒä¸Šä¸€ä¸ªä¾‹å­ï¼ŒLi Si 32å², Zhao Liu 45å²)

    QTableView tableView;
    tableView.setModel(&model);

    // åˆ›å»ºè‡ªå®šä¹‰ä»£ç†å¹¶è®¾ç½®ç»™è§†å›¾
    HighlightDelegate *delegate = new HighlightDelegate(&tableView);
    tableView.setItemDelegate(delegate); // ä¸ºæ•´ä¸ªè§†å›¾è®¾ç½®ä»£ç†
    // ä¹Ÿå¯ä»¥ä½¿ç”¨ setItemDelegateForRow, setItemDelegateForColumn ä¸ºç‰¹å®šè¡Œ/åˆ—è®¾ç½®ä»£ç†

    tableView.resize(500, 200);
    tableView.show();

    return app.exec();
}
```

ğŸ› ï¸ **ä»£ç è§£é‡Š**ï¼š

*   æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª `HighlightDelegate` ç±»ï¼Œç»§æ‰¿è‡ª `QStyledItemDelegate`ã€‚
*   é‡å†™äº† `paint` æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæˆ‘ä»¬åˆ¤æ–­å¦‚æœå½“å‰å•å…ƒæ ¼æ˜¯ç¬¬äºŒåˆ—ï¼ˆå¹´é¾„åˆ—ï¼‰ä¸”å¹´é¾„å¤§äº 30ï¼Œå°±åœ¨ç»˜åˆ¶å•å…ƒæ ¼èƒŒæ™¯æ—¶ä½¿ç”¨ä¸€ä¸ªæµ…çº¢è‰²çš„ç”»åˆ·ã€‚
*   æœ€åï¼Œæˆ‘ä»¬è¿˜æ˜¯è°ƒç”¨åŸºç±»çš„ `paint` æ–¹æ³•ï¼Œè®©å®ƒæ¥å¤„ç†æ–‡æœ¬ç­‰æ ‡å‡†å†…å®¹çš„ç»˜åˆ¶ã€‚
*   åœ¨ `main` å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†è¿™ä¸ªè‡ªå®šä¹‰ä»£ç†çš„å®ä¾‹ï¼Œå¹¶é€šè¿‡ `setItemDelegate` æ–¹æ³•å°†å…¶è®¾ç½®ç»™è¡¨æ ¼è§†å›¾ã€‚

### ğŸ”„ å¤šä¸ªè§†å›¾å…±äº«ä¸€ä¸ªæ¨¡å‹

Qt MVC çš„ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½æ˜¯**å¤šä¸ªè§†å›¾å¯ä»¥å…±äº«åŒä¸€ä¸ªæ¨¡å‹**ï¼Œä¿æŒæ•°æ®çš„åŒæ­¥æ˜¾ç¤ºã€‚

```cpp
#include <QtWidgets>

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    // åˆ›å»ºæ•°æ®å’Œæ¨¡å‹ (åŒä¸Š)
    QStandardItemModel model(4, 3);
    model.setHorizontalHeaderLabels({"Name", "Age", "Department"});
    // ... (å¡«å……æ•°æ®)

    // åˆ›å»ºä¸‰ä¸ªä¸åŒçš„è§†å›¾
    QTableView tableView;
    QListView listView;
    QTreeView treeView;

    // ä¸ºæ‰€æœ‰è§†å›¾è®¾ç½®ç›¸åŒçš„æ¨¡å‹
    tableView.setModel(&model);
    listView.setModel(&model);
    treeView.setModel(&model);

    // åˆ›å»ºä¸€ä¸ªåˆ†å‰²çª—å£å¹¶æ·»åŠ ä¸‰ä¸ªè§†å›¾
    QSplitter *splitter = new QSplitter;
    splitter->addWidget(&tableView);
    splitter->addWidget(&listView);
    splitter->addWidget(&treeView);
    splitter->setWindowTitle("Multiple Views Sharing One Model");
    splitter->resize(1000, 400);
    splitter->show();

    // è®¾ç½®åˆ—è¡¨è§†å›¾å’Œæ ‘è§†å›¾çš„æ ¹ç´¢å¼•ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰
    // listView.setRootIndex(model.index(0,0));
    // treeView.setRootIndex(model.index(0,0));

    return app.exec();
}
```

ğŸ› ï¸ **ä»£ç è§£é‡Š**ï¼š

*   æˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªä¸åŒç±»å‹çš„è§†å›¾ï¼š`QTableView`, `QListView`, `QTreeView`ã€‚
*   å®ƒä»¬éƒ½é€šè¿‡ `setModel()` æ–¹æ³•è®¾ç½®äº†**åŒä¸€ä¸ªæ¨¡å‹** (`&model`)ã€‚
*   å½“ä½ é€šè¿‡ä»»ä½•ä¸€ä¸ªè§†å›¾ä¿®æ”¹æ•°æ®æ—¶ï¼ˆä¾‹å¦‚åœ¨è¡¨æ ¼è§†å›¾ä¸­ç¼–è¾‘ä¸€ä¸ªå•å…ƒæ ¼ï¼‰ï¼Œæ¨¡å‹ä¼šå‘å‡ºæ•°æ®å˜åŒ–çš„ä¿¡å·ï¼Œå…¶ä»–ä¸¤ä¸ªè§†å›¾ä¼šè‡ªåŠ¨æ¥æ”¶å¹¶æ›´æ–°æ˜¾ç¤ºï¼Œä¿æŒåŒæ­¥ã€‚
*   è¿™ä¸ªç‰¹æ€§éå¸¸é€‚åˆéœ€è¦ä»ä¸åŒè§’åº¦è§‚å¯Ÿå’Œæ“ä½œåŒä¸€ä»½æ•°æ®çš„åº”ç”¨åœºæ™¯ã€‚

### ğŸ“ æ€»ç»“ä¸å»ºè®®

*   **æ ¸å¿ƒä¼˜åŠ¿**ï¼šQt çš„æ¨¡å‹/è§†å›¾æ¶æ„å®ç°äº†**æ•°æ®ä¸æ˜¾ç¤ºçš„åˆ†ç¦»**ï¼Œæ¨¡å‹è´Ÿè´£æ•°æ®ç®¡ç†ï¼Œè§†å›¾è´Ÿè´£å±•ç¤ºï¼Œä»£ç†è´Ÿè´£ä¸ªæ€§åŒ–çš„æ˜¾ç¤ºå’Œç¼–è¾‘ã€‚è¿™ä½¿å¾—ä»£ç æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤å’Œæ‰©å±•ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾å®ç°å¤šä¸ªè§†å›¾åŒæ­¥ã€‚
*   **æ¨¡å‹é€‰æ‹©**ï¼šå¯¹äºç®€å•æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ `QStandardItemModel`ã€‚å¯¹äºå¤§å‹æˆ–ç‰¹æ®Šç»“æ„çš„æ•°æ®æºï¼ˆå¦‚æ•°æ®åº“ã€è‡ªå®šä¹‰æ•°æ®ç»“æ„ï¼‰ï¼Œæœ€å¥½ç»§æ‰¿ `QAbstractItemModel` æˆ–å…¶å­ç±»ï¼ˆå¦‚ `QAbstractTableModel`ï¼‰æ¥è‡ªå®šä¹‰æ¨¡å‹ï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶æ•°æ®è®¿é—®å’Œä¼˜åŒ–æ€§èƒ½ã€‚
*   **ä»£ç†è¿ç”¨**ï¼šåˆ©ç”¨ä»£ç† (`Delegate`) å¯ä»¥é«˜åº¦å®šåˆ¶åŒ–æ•°æ®çš„æ˜¾ç¤ºå’Œç¼–è¾‘æ–¹å¼ï¼Œè¿™æ˜¯å¢å¼ºè§†å›¾è¡¨ç°åŠ›çš„å…³é”®ã€‚
*   **å®è·µå»ºè®®**ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ˜ç¡®å„ç»„ä»¶èŒè´£ã€‚æ¨¡å‹åº”ä¸“æ³¨äºæ•°æ®è¯»å†™å’Œä¸šåŠ¡é€»è¾‘ï¼Œè§†å›¾ä¸“æ³¨äºç”¨æˆ·äº¤äº’å’Œå‘ˆç°ï¼Œä»£ç†ä¸“æ³¨äºç‰¹å®šæ•°æ®é¡¹çš„è§†è§‰æ•ˆæœå’Œç¼–è¾‘è¡Œä¸ºã€‚

å¸Œæœ›è¿™äº›è§£é‡Šå’Œä»£ç ç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œè¿ç”¨ Qt ä¸­çš„ MVCï¼ˆæ¨¡å‹/è§†å›¾ï¼‰æ¡†æ¶ã€‚

## Qt QVariant è¯¦è§£ï¼šä¸‡èƒ½çš„æ•°æ®å®¹å™¨

åœ¨ Qt æ¡†æ¶ä¸­ï¼Œ`QVariant` æ˜¯ä¸€ä¸ªéå¸¸é‡è¦ä¸”å¼ºå¤§çš„ç±»ï¼Œå®ƒä½œä¸º**é€šç”¨æ•°æ®ç±»å‹å®¹å™¨**ï¼Œå¯ä»¥å­˜å‚¨å’Œç®¡ç†å¤šç§ä¸åŒç±»å‹çš„æ•°æ®ã€‚ç®€å•æ¥è¯´ï¼Œ`QVariant` å°±åƒæ˜¯ä¸€ä¸ª"ä¸‡èƒ½å˜é‡"ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ä¿å­˜ã€ä¼ é€’å’Œè½¬æ¢å„ç§ç±»å‹çš„æ•°æ®ã€‚

### ğŸ“¦ QVariant çš„æ ¸å¿ƒæ¦‚å¿µ

#### ä»€ä¹ˆæ˜¯ QVariantï¼Ÿ

`QVariant` æ˜¯ Qt æä¾›çš„ä¸€ä¸ª**ç±»å‹æ“¦é™¤å®¹å™¨**ï¼Œå®ƒèƒ½å¤Ÿï¼š

- å­˜å‚¨ Qt å†…ç½®çš„å¤§å¤šæ•°æ•°æ®ç±»å‹å’Œè‡ªå®šä¹‰ç±»å‹
- åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ç¡®å®šå’Œè½¬æ¢å­˜å‚¨çš„æ•°æ®ç±»å‹
- æä¾›ç±»å‹å®‰å…¨çš„è®¿é—®æœºåˆ¶
- ä½œä¸ºé€šç”¨çš„æ•°æ®ä¼ é€’åª’ä»‹

#### ä¸ºä»€ä¹ˆéœ€è¦ QVariantï¼Ÿ

åœ¨ Qt æ¡†æ¶ä¸­ï¼Œè®¸å¤šåœ°æ–¹éœ€è¦å¤„ç†ä¸ç¡®å®šç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š

- æ¨¡å‹/è§†å›¾æ¶æ„ä¸­çš„æ•°æ®é¡¹
- å±æ€§ç³»ç»Ÿ
- ä¿¡å·æ§½å‚æ•°ä¼ é€’
- è®¾ç½®å’Œé…ç½®å­˜å‚¨

### ğŸ§° QVariant çš„åŸºæœ¬ç‰¹æ€§

#### æ”¯æŒçš„æ•°æ®ç±»å‹

`QVariant` æ”¯æŒå‡ ä¹æ‰€æœ‰å¸¸è§çš„ Qt å’Œ C++ æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ï¼š

| ç±»åˆ«        | æ•°æ®ç±»å‹ç¤ºä¾‹                                     |
| ----------- | ------------------------------------------------ |
| åŸºæœ¬ç±»å‹    | `int`, `bool`, `double`, `float`, `QString`      |
| Qt æ ¸å¿ƒç±»å‹ | `QColor`, `QFont`, `QSize`, `QRect`, `QDateTime` |
| å®¹å™¨ç±»å‹    | `QList`, `QMap`, `QStringList`                   |
| è‡ªå®šä¹‰ç±»å‹  | ä½¿ç”¨ `Q_DECLARE_METATYPE` æ³¨å†Œçš„ç±»å‹             |

#### æ ¸å¿ƒåŠŸèƒ½

1. **ç±»å‹æ“¦é™¤**ï¼šéšè—å…·ä½“ç±»å‹ä¿¡æ¯ï¼Œæä¾›ç»Ÿä¸€æ¥å£
2. **ç±»å‹å®‰å…¨**ï¼šæä¾›å®‰å…¨çš„ç±»å‹è½¬æ¢å’Œæ£€æŸ¥æœºåˆ¶
3. **ç©ºå€¼æ”¯æŒ**ï¼šå¯ä»¥è¡¨ç¤ºç©ºå€¼æˆ–æ— æ•ˆå€¼
4. **å¤åˆ¶è¯­ä¹‰**ï¼šæ·±æ‹·è´å­˜å‚¨çš„æ•°æ®

### ğŸ’» åŸºæœ¬ç”¨æ³•å’Œä»£ç ç¤ºä¾‹

#### åˆ›å»ºå’Œèµ‹å€¼

```cpp
#include <QVariant>
#include <QDebug>
#include <QColor>
#include <QDateTime>

void basicUsage() {
    // åˆ›å»ºå„ç§ç±»å‹çš„ QVariant
    QVariant intVar = 42;                    // int
    QVariant boolVar = true;                 // bool
    QVariant stringVar = QString("Hello");   // QString
    QVariant colorVar = QColor(Qt::red);     // QColor
    QVariant dateVar = QDateTime::currentDateTime(); // QDateTime
    
    // ä½¿ç”¨æ„é€ å‡½æ•°
    QVariant doubleVar(3.14159);
    
    // ä½¿ç”¨ setValue() æ–¹æ³•
    QVariant listVar;
    listVar.setValue(QStringList() << "A" << "B" << "C");
}
```

#### ç±»å‹æ£€æŸ¥å’Œè½¬æ¢

```cpp
void typeConversion() {
    QVariant var = 42;
    
    // æ£€æŸ¥ç±»å‹
    qDebug() << "Type name:" << var.typeName(); // è¾“å‡º: int
    qDebug() << "Can convert to double?" << var.canConvert<double>(); // true
    
    // å®‰å…¨è½¬æ¢
    if (var.canConvert<int>()) {
        int value = var.toInt();
        qDebug() << "Integer value:" << value;
    }
    
    // è½¬æ¢åˆ°ä¸åŒç±»å‹
    double doubleValue = var.toDouble(); // 42.0
    QString stringValue = var.toString(); // "42"
    
    // ä½¿ç”¨æ¨¡æ¿å‡½æ•°è¿›è¡Œè½¬æ¢
    int intValue = var.value<int>();
    
    // æ£€æŸ¥æ˜¯å¦æœ‰æ•ˆ
    if (var.isValid()) {
        qDebug() << "Variant is valid";
    }
    
    // æ£€æŸ¥æ˜¯å¦ä¸ºç©º
    QVariant emptyVar;
    if (emptyVar.isNull()) {
        qDebug() << "Variant is null";
    }
}
```

#### åœ¨ Qt ç±»ä¸­çš„å®é™…åº”ç”¨

```cpp
#include <QSettings>
#include <QCoreApplication>

void practicalExamples() {
    // 1. åœ¨è®¾ç½®/é…ç½®ä¸­çš„åº”ç”¨
    QSettings settings("MyCompany", "MyApp");
    
    // ä¿å­˜å„ç§ç±»å‹çš„æ•°æ®
    settings.setValue("fontSize", 12);
    settings.setValue("windowColor", QColor(Qt::blue));
    settings.setValue("lastLogin", QDateTime::currentDateTime());
    
    // è¯»å–æ•°æ®ï¼ˆè‡ªåŠ¨è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ï¼‰
    int fontSize = settings.value("fontSize", 10).toInt(); // é»˜è®¤å€¼ 10
    QColor color = settings.value("windowColor").value<QColor>();
    
    // 2. åœ¨æ¨¡å‹/è§†å›¾ä¸­çš„åº”ç”¨
    QVariant displayData = QString("Display Text");
    QVariant decorationData = QColor(Qt::red);
    QVariant tooltipData = QString("This is a tooltip");
    
    // è¿™äº› QVariant å¯ä»¥ç›´æ¥ç”¨äº QAbstractItemModel çš„ data() æ–¹æ³•
}
```

### ğŸ› ï¸ è‡ªå®šä¹‰ç±»å‹æ”¯æŒ

è¦è®©è‡ªå®šä¹‰ç±»å‹èƒ½å¤Ÿä¸ `QVariant` ä¸€èµ·å·¥ä½œï¼Œéœ€è¦è¿›è¡Œä¸€äº›é¢å¤–çš„æ­¥éª¤ï¼š

#### æ³¨å†Œè‡ªå®šä¹‰ç±»å‹

```cpp
#include <QVariant>
#include <QMetaType>

// è‡ªå®šä¹‰æ•°æ®ç±»å‹
struct Person {
    QString name;
    int age;
    QString email;
    
    // éœ€è¦æä¾›ç›¸ç­‰è¿ç®—ç¬¦ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„
    bool operator==(const Person &other) const {
        return name == other.name && age == other.age && email == other.email;
    }
};

// æ³¨å†Œè‡ªå®šä¹‰ç±»å‹ï¼ˆå¿…é¡»åœ¨æ‰€æœ‰ä½¿ç”¨ä¹‹å‰ï¼‰
Q_DECLARE_METATYPE(Person)

void customTypeExample() {
    // æ³¨å†Œç±»å‹ï¼ˆåªéœ€è¦ä¸€æ¬¡ï¼Œé€šå¸¸åœ¨åº”ç”¨ç¨‹åºåˆå§‹åŒ–æ—¶ï¼‰
    qRegisterMetaType<Person>("Person");
    
    // åˆ›å»ºè‡ªå®šä¹‰ç±»å‹å®ä¾‹
    Person person;
    person.name = "Alice";
    person.age = 30;
    person.email = "alice@example.com";
    
    // å­˜å‚¨åˆ° QVariant
    QVariant var = QVariant::fromValue(person);
    
    // ä» QVariant ä¸­æå–
    if (var.canConvert<Person>()) {
        Person extractedPerson = var.value<Person>();
        qDebug() << "Name:" << extractedPerson.name;
        qDebug() << "Age:" << extractedPerson.age;
    }
    
    // æ£€æŸ¥ç±»å‹
    qDebug() << "Stored type:" << var.typeName(); // è¾“å‡º: Person
}
```

### ğŸ”§ é«˜çº§ç”¨æ³•

#### ä½¿ç”¨ QVariantList å’Œ QVariantMap

```cpp
void containerExamples() {
    // QVariantListï¼ˆå®é™…ä¸Šæ˜¯ QList<QVariant>ï¼‰
    QVariantList list;
    list.append(42);
    list.append("Hello");
    list.append(QColor(Qt::red));
    
    // éå† QVariantList
    for (const QVariant &item : list) {
        qDebug() << "Item:" << item << "Type:" << item.typeName();
    }
    
    // QVariantMapï¼ˆå®é™…ä¸Šæ˜¯ QMap<QString, QVariant>ï¼‰
    QVariantMap map;
    map["name"] = "John Doe";
    map["age"] = 25;
    map["active"] = true;
    map["lastLogin"] = QDateTime::currentDateTime();
    
    // è®¿é—® QVariantMap
    QString name = map["name"].toString();
    int age = map["age"].toInt();
    
    // éå† QVariantMap
    for (auto it = map.begin(); it != map.end(); ++it) {
        qDebug() << it.key() << ":" << it.value();
    }
}
```

#### ç±»å‹è½¬æ¢å’ŒéªŒè¯

```cpp
void advancedConversion() {
    QVariant var = "3.14";
    
    // å°è¯•è½¬æ¢ï¼Œå¦‚æœå¤±è´¥è¿”å›é»˜è®¤å€¼
    double value = var.toDouble(); // 3.14
    
    // å¸¦æˆåŠŸæŒ‡ç¤ºçš„è½¬æ¢
    bool ok;
    int intValue = var.toInt(&ok);
    if (!ok) {
        qDebug() << "Conversion to int failed";
    }
    
    // ä½¿ç”¨ qvariant_castï¼ˆæ¨¡æ¿æ–¹å¼ï¼‰
    QString str = qvariant_cast<QString>(var);
    
    // æ£€æŸ¥ç‰¹å®šç±»å‹
    if (var.typeId() == QMetaType::QString) {
        qDebug() << "It's a string!";
    }
}
```

### âš ï¸ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ

1. **æ€§èƒ½è€ƒè™‘**ï¼š

   ```cpp
   // é¿å…ä¸å¿…è¦çš„æ‹·è´
   const QVariant &getData() { 
       static QVariant data = 42; 
       return data; // è¿”å› const å¼•ç”¨
   }
   ```

2. **ç±»å‹å®‰å…¨**ï¼š

   ```cpp
   // æ€»æ˜¯æ£€æŸ¥ç±»å‹è½¬æ¢æ˜¯å¦æˆåŠŸ
   QVariant var = getSomeData();
   if (var.canConvert<MyType>()) {
       MyType value = var.value<MyType>();
       // å®‰å…¨ä½¿ç”¨ value
   }
   ```

3. **ç©ºå€¼å¤„ç†**ï¼š

   ```cpp
   QVariant possiblyNull = getPossiblyNullData();
   if (possiblyNull.isValid() && !possiblyNull.isNull()) {
       // å®‰å…¨ä½¿ç”¨æ•°æ®
   }
   ```

### ğŸ¯ æ€»ç»“

`QVariant` æ˜¯ Qt æ¡†æ¶ä¸­æå…¶é‡è¦çš„ä¸€ä¸ªç±»ï¼Œå®ƒæä¾›äº†ï¼š

- **ç±»å‹çµæ´»æ€§**ï¼šå¯ä»¥å­˜å‚¨å’Œç®¡ç†å¤šç§ä¸åŒç±»å‹çš„æ•°æ®
- **è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯**ï¼šå…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œè½¬æ¢ç±»å‹
- **é€šç”¨æ¥å£**ï¼šä¸ºä¸ç¡®å®šç±»å‹çš„æ•°æ®æä¾›ç»Ÿä¸€çš„å¤„ç†æ–¹å¼
- **Qt é›†æˆ**ï¼šæ·±åº¦é›†æˆåˆ° Qt çš„å„ä¸ªæ¨¡å—ä¸­

é€šè¿‡ `QVariant`ï¼ŒQt å®ç°äº†é«˜åº¦çµæ´»çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å‹/è§†å›¾æ¶æ„ã€å±æ€§ç³»ç»Ÿå’Œè®¾ç½®å­˜å‚¨ç­‰åœºæ™¯ä¸­å‘æŒ¥ç€å…³é”®ä½œç”¨ã€‚æŒæ¡ `QVariant` çš„ä½¿ç”¨å¯¹äºè¿›è¡Œé«˜æ•ˆçš„ Qt å¼€å‘è‡³å…³é‡è¦ã€‚

# Qtä¿¡å·æ§½è·¨çº¿ç¨‹é€šä¿¡æœºåˆ¶è¯¦è§£

Qtçš„ä¿¡å·å’Œæ§½æœºåˆ¶æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå®ƒæä¾›äº†ä¸€ç§å®‰å…¨ã€æœ‰åºçš„è·¨çº¿ç¨‹é€šä¿¡æ–¹å¼ã€‚

## åŸºæœ¬æœºåˆ¶æ¦‚è¿°

### 1. çº¿ç¨‹å…³è”æ€§ï¼ˆThread Affinityï¼‰

æ¯ä¸ªQObjectå®ä¾‹éƒ½æœ‰ä¸€ä¸ª"çº¿ç¨‹å…³è”æ€§" - å³å®ƒå±äºå“ªä¸ªçº¿ç¨‹ã€‚è¿™ä¸ªå…³è”æ€§å†³å®šäº†ï¼š

- å¯¹è±¡çš„äº‹ä»¶å¤„ç†åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ
- ä¿¡å·çš„ä¼ é€’æ–¹å¼

### 2. è¿æ¥ç±»å‹ï¼ˆConnection Typesï¼‰

Qtæä¾›äº†5ç§ä¿¡å·æ§½è¿æ¥æ–¹å¼ï¼š

- `Qt::AutoConnection`ï¼ˆé»˜è®¤ï¼‰ï¼šè‡ªåŠ¨å†³å®šè¿æ¥æ–¹å¼
- `Qt::DirectConnection`ï¼šç›´æ¥è°ƒç”¨ï¼Œç±»ä¼¼å‡½æ•°è°ƒç”¨
- `Qt::QueuedConnection`ï¼šé˜Ÿåˆ—è¿æ¥ï¼Œç”¨äºè·¨çº¿ç¨‹é€šä¿¡
- `Qt::BlockingQueuedConnection`ï¼šé˜»å¡å¼é˜Ÿåˆ—è¿æ¥
- `Qt::UniqueConnection`ï¼šå”¯ä¸€è¿æ¥ï¼Œé˜²æ­¢é‡å¤è¿æ¥

## é˜Ÿåˆ—è¿æ¥ï¼ˆQueuedConnectionï¼‰æœºåˆ¶è¯¦è§£

### å·¥ä½œåŸç†

å½“ä¿¡å·å’Œæ§½å¤„äºä¸åŒçº¿ç¨‹ä¸”ä½¿ç”¨`Qt::QueuedConnection`æ—¶ï¼š

1. **ä¿¡å·å‘å°„**ï¼šåœ¨å‘é€è€…çº¿ç¨‹ä¸­å‘å°„ä¿¡å·
2. **äº‹ä»¶å°è£…**ï¼šQtå°†ä¿¡å·å‚æ•°å’Œæ¥æ”¶è€…ä¿¡æ¯å°è£…æˆä¸€ä¸ª`QMetaCallEvent`äº‹ä»¶
3. **äº‹ä»¶æŠ•é€’**ï¼šå°†è¯¥äº‹ä»¶æŠ•é€’åˆ°æ¥æ”¶è€…æ‰€åœ¨çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—ä¸­
4. **äº‹ä»¶å¤„ç†**ï¼šæ¥æ”¶è€…çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ä»é˜Ÿåˆ—ä¸­å–å‡ºå¹¶å¤„ç†è¯¥äº‹ä»¶
5. **æ§½å‡½æ•°æ‰§è¡Œ**ï¼šåœ¨æ¥æ”¶è€…çº¿ç¨‹ä¸­è°ƒç”¨ç›¸åº”çš„æ§½å‡½æ•°

### ä»£ç ç¤ºä¾‹

```cpp
// åœ¨å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
class Worker : public QObject {
    Q_OBJECT
public slots:
    void doWork() {
        // è€—æ—¶æ“ä½œ...
        emit resultReady(result);
    }
signals:
    void resultReady(const QString &result);
};

// åœ¨ä¸»çº¿ç¨‹ä¸­
int main(int argc, char *argv[]) {
    QApplication app(argc, argv);
    
    QThread workerThread;
    Worker worker;
    worker.moveToThread(&workerThread);
    
    // è¿æ¥ä¿¡å·æ§½ - è‡ªåŠ¨é€‰æ‹©QueuedConnection
    connect(&worker, &Worker::resultReady, 
            this, &MainWindow::handleResult);
    
    workerThread.start();
    
    return app.exec();
}
```

## çº¿ç¨‹å®‰å…¨æ€§ä¸æœ‰åºæ€§ä¿è¯

### 1. çº¿ç¨‹å®‰å…¨æ€§

- **äº‹ä»¶é˜Ÿåˆ—çº¿ç¨‹å®‰å…¨**ï¼šQtä½¿ç”¨äº’æ–¥é”ä¿æŠ¤äº‹ä»¶é˜Ÿåˆ—çš„è®¿é—®
- **åŸå­æ“ä½œ**ï¼šäº‹ä»¶æŠ•é€’æ˜¯åŸå­æ€§çš„ï¼Œä¸ä¼šè¢«æ‰“æ–­
- **å†…å­˜å±éšœ**ï¼šç¡®ä¿å†…å­˜è®¿é—®çš„æ­£ç¡®é¡ºåº

### 2. æœ‰åºæ€§ä¿è¯

- **FIFOé¡ºåº**ï¼šäº‹ä»¶é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºå¤„ç†
- **å‘é€é¡ºåºä¿æŒ**ï¼šä¿¡å·å‘å°„çš„é¡ºåºä¸æ§½å‡½æ•°æ‰§è¡Œçš„é¡ºåºä¸€è‡´
- **çº¿ç¨‹å†…é¡ºåº**ï¼šåŒä¸€çº¿ç¨‹å†…çš„äº‹ä»¶å¤„ç†ä¿æŒé¡ºåºæ€§

### 3. åº•å±‚å®ç°æœºåˆ¶

```cpp
// ç®€åŒ–çš„æŠ•é€’è¿‡ç¨‹ï¼ˆä¼ªä»£ç ï¼‰
void QMetaObject::activate(QObject *sender, int signal_index, void **argv) {
    // æ£€æŸ¥è¿æ¥ç±»å‹
    if (receiver->thread() != sender->thread()) {
        // åˆ›å»ºäº‹ä»¶å¹¶æŠ•é€’åˆ°æ¥æ”¶è€…çº¿ç¨‹çš„äº‹ä»¶é˜Ÿåˆ—
        QMetaCallEvent *ev = new QMetaCallEvent(sender, signal_index, argv);
        QCoreApplication::postEvent(receiver, ev);
    } else {
        // ç›´æ¥è¿æ¥ï¼Œç«‹å³è°ƒç”¨
        // ...
    }
}
```

## è‡ªåŠ¨è¿æ¥ï¼ˆAutoConnectionï¼‰çš„æ™ºèƒ½é€‰æ‹©

å½“ä½¿ç”¨é»˜è®¤çš„`Qt::AutoConnection`æ—¶ï¼ŒQtä¼šåœ¨ä¿¡å·å‘å°„æ—¶åŠ¨æ€å†³å®šè¿æ¥æ–¹å¼ï¼š

1. **åŒçº¿ç¨‹**ï¼šå¦‚æœå‘é€è€…å’Œæ¥æ”¶è€…åœ¨åŒä¸€çº¿ç¨‹ï¼Œä½¿ç”¨`DirectConnection`
2. **è·¨çº¿ç¨‹**ï¼šå¦‚æœå‘é€è€…å’Œæ¥æ”¶è€…åœ¨ä¸åŒçº¿ç¨‹ï¼Œä½¿ç”¨`QueuedConnection`

```cpp
// Qtå†…éƒ¨çš„å†³ç­–é€»è¾‘ï¼ˆç®€åŒ–ï¼‰
Qt::ConnectionType QObject::connectionType(const QObject *receiver) const {
    if (QThread::currentThread() == receiver->thread()) {
        return Qt::DirectConnection;
    } else {
        return Qt::QueuedConnection;
    }
}
```

## å®é™…åº”ç”¨åœºæ™¯

### 1. åå°ä»»åŠ¡å¤„ç†

```cpp
// å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œä¸»çº¿ç¨‹æ›´æ–°UI
class TaskController : public QObject {
    Q_OBJECT
public:
    void startTask() {
        QThread *thread = new QThread;
        Worker *worker = new Worker;
        worker->moveToThread(thread);
        
        connect(thread, &QThread::started, worker, &Worker::doWork);
        connect(worker, &Worker::resultReady, this, &TaskController::handleResult);
        connect(worker, &Worker::finished, thread, &QThread::quit);
        connect(worker, &Worker::finished, worker, &Worker::deleteLater);
        connect(thread, &QThread::finished, thread, &QThread::deleteLater);
        
        thread->start();
    }
    
public slots:
    void handleResult(const QString &result) {
        // åœ¨ä¸»çº¿ç¨‹ä¸­å®‰å…¨æ›´æ–°UI
        ui->resultLabel->setText(result);
    }
};
```

### 2. å¤šç”Ÿäº§è€…-å•æ¶ˆè´¹è€…æ¨¡å¼

```cpp
// å¤šä¸ªå·¥ä½œçº¿ç¨‹å‘ä¸»çº¿ç¨‹å‘é€æ•°æ®
class DataProcessor : public QObject {
    Q_OBJECT
public:
    void processFromMultipleThreads() {
        for (int i = 0; i < 5; ++i) {
            QThread *thread = new QThread;
            DataProducer *producer = new DataProducer;
            producer->moveToThread(thread);
            
            connect(thread, &QThread::started, producer, &DataProducer::produce);
            connect(producer, &DataProducer::dataReady, 
                    this, &DataProcessor::processData, Qt::QueuedConnection);
            
            thread->start();
        }
    }
    
public slots:
    void processData(const QByteArray &data) {
        // æ‰€æœ‰æ•°æ®éƒ½ä¼šæŒ‰åˆ°è¾¾é¡ºåºåœ¨ä¸»çº¿ç¨‹ä¸­å¤„ç†
        // çº¿ç¨‹å®‰å…¨ä¸”æœ‰é¡ºåºä¿è¯
    }
};
```

## æ€§èƒ½è€ƒè™‘ä¸æœ€ä½³å®è·µ

### 1. æ€§èƒ½å¼€é”€

- **äº‹ä»¶åˆ›å»º**ï¼šæ¯æ¬¡ä¿¡å·å‘å°„éƒ½éœ€è¦åˆ›å»ºäº‹ä»¶å¯¹è±¡
- **å†…å­˜åˆ†é…**ï¼šå‚æ•°éœ€è¦æ‹·è´åˆ°äº‹ä»¶ä¸­
- **çº¿ç¨‹åˆ‡æ¢**ï¼šæ¶‰åŠçº¿ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢

### 2. ä¼˜åŒ–å»ºè®®

```cpp
// é¿å…é¢‘ç¹çš„å°ä¿¡å·
// ä¸ä½³çš„åšæ³•ï¼šé¢‘ç¹å‘å°„å°ä¿¡å·
emit dataUpdated(singleValue);

// æ›´å¥½çš„åšæ³•ï¼šæ‰¹é‡å¤„ç†
void collectAndEmit() {
    if (batchData.size() >= BATCH_SIZE) {
        emit dataBatchReady(batchData);
        batchData.clear();
    }
}
```

### 3. æ³¨æ„äº‹é¡¹

- **æ­»é”é£é™©**ï¼š`Qt::BlockingQueuedConnection`å¯èƒ½å¼•èµ·æ­»é”
- **å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ**ï¼šç¡®ä¿æ¥æ”¶è€…å¯¹è±¡åœ¨æ§½å‡½æ•°è¢«è°ƒç”¨æ—¶ä»ç„¶å­˜åœ¨
- **å‚æ•°ç±»å‹**ï¼šå‚æ•°ç±»å‹å¿…é¡»æ³¨å†Œä¸ºQtå…ƒç±»å‹ï¼ˆä½¿ç”¨`qRegisterMetaType`ï¼‰

## æ€»ç»“

Qtçš„ä¿¡å·æ§½æœºåˆ¶é€šè¿‡é˜Ÿåˆ—è¿æ¥æ–¹å¼æä¾›äº†å¼ºå¤§çš„è·¨çº¿ç¨‹é€šä¿¡èƒ½åŠ›ï¼š

1. **çº¿ç¨‹å®‰å…¨**ï¼šé€šè¿‡äº‹ä»¶é˜Ÿåˆ—å’Œäº’æ–¥é”ä¿è¯
2. **æœ‰åºæ€§**ï¼šFIFOäº‹ä»¶å¤„ç†ä¿è¯æ‰§è¡Œé¡ºåº
3. **çµæ´»æ€§**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³è¿æ¥æ–¹å¼
4. **è§£è€¦åˆ**ï¼šå‘é€è€…å’Œæ¥æ”¶è€…ä¸éœ€è¦çŸ¥é“å¯¹æ–¹çš„çº¿ç¨‹æƒ…å†µ

è¿™ç§æœºåˆ¶ä½¿å¾—å¤šçº¿ç¨‹ç¼–ç¨‹æ›´åŠ ç®€å•å’Œå®‰å…¨ï¼Œæ˜¯Qtæ¡†æ¶çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ã€‚

# Qt Model-View-Delegate æ¡†æ¶è¯¦ç»†è¯´æ˜

## æ¦‚è¿°

Qtçš„Model-Viewæ¶æ„æ˜¯ä¸€ç§ç”¨äºåˆ†ç¦»æ•°æ®å­˜å‚¨ä¸æ•°æ®å±•ç¤ºçš„é«˜çº§è®¾è®¡æ¨¡å¼ã€‚è¯¥æ¡†æ¶ç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šModelï¼ˆæ•°æ®æ¨¡å‹ï¼‰ã€Viewï¼ˆè§†å›¾ï¼‰å’ŒDelegateï¼ˆå§”æ‰˜ï¼‰ã€‚è¿™ç§åˆ†ç¦»ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥çµæ´»åœ°å¤„ç†æ•°æ®ï¼ŒåŒæ—¶ä¿æŒç”¨æˆ·ç•Œé¢çš„ä¸€è‡´æ€§ã€‚

## Model (æ•°æ®æ¨¡å‹)

### Model çš„ç±»å‹

#### 1. åŸºç¡€æ¨¡å‹ç±»

- **QAbstractItemModel**: æ‰€æœ‰æ¨¡å‹çš„æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰äº†æ¨¡å‹å¿…é¡»å®ç°çš„æ¥å£
- **QAbstractListModel**: ç”¨äºåˆ—è¡¨æ•°æ®çš„æŠ½è±¡åŸºç±»
- **QAbstractTableModel**: ç”¨äºè¡¨æ ¼æ•°æ®çš„æŠ½è±¡åŸºç±»

#### 2. å…·ä½“å®ç°æ¨¡å‹

- **QStandardItemModel**: é€šç”¨æ¨¡å‹ï¼Œå¯å­˜å‚¨ä»»æ„æ•°æ®
- **QStringListModel**: ä¸“é—¨ç”¨äºå­—ç¬¦ä¸²åˆ—è¡¨çš„æ¨¡å‹
- **QFileSystemModel**: æ–‡ä»¶ç³»ç»Ÿæ¨¡å‹
- **QSqlQueryModel**, **QSqlTableModel**, **QSqlRelationalTableModel**: æ•°æ®åº“æ¨¡å‹

### Model çš„æ ¸å¿ƒæ–¹æ³•

```cpp
// å¿…é¡»å®ç°çš„åŸºæœ¬æ–¹æ³•
virtual int rowCount(const QModelIndex &parent = QModelIndex()) const = 0;
virtual int columnCount(const QModelIndex &parent = QModelIndex()) const = 0;
virtual QVariant data(const QModelIndex &index, int role = Qt::DisplayRole) const = 0;
virtual QVariant headerData(int section, Qt::Orientation orientation, int role = Qt::DisplayRole) const;

// å¯ç¼–è¾‘æ¨¡å‹éœ€è¦å®ç°çš„æ–¹æ³•
virtual bool setData(const QModelIndex &index, const QVariant &value, int role = Qt::EditRole);
virtual bool setHeaderData(int section, Qt::Orientation orientation, const QVariant &value, int role = Qt::EditRole);
virtual Qt::ItemFlags flags(const QModelIndex &index) const;

// å±‚æ¬¡ç»“æ„æ¨¡å‹éœ€è¦çš„æ–¹æ³•
virtual QModelIndex index(int row, int column, const QModelIndex &parent = QModelIndex()) const;
virtual QModelIndex parent(const QModelIndex &index) const;
```

### æ•°æ®è§’è‰² (Data Roles)

```cpp
// å¸¸ç”¨æ•°æ®è§’è‰²
enum ItemDataRole {
    DisplayRole,        // æ˜¾ç¤ºæ–‡æœ¬
    DecorationRole,     // å›¾æ ‡è£…é¥°
    EditRole,           // ç¼–è¾‘æ–‡æœ¬
    ToolTipRole,        // å·¥å…·æç¤º
    StatusTipRole,      // çŠ¶æ€æ æç¤º
    WhatsThisRole,      // "è¿™æ˜¯ä»€ä¹ˆ"æç¤º
    SizeHintRole,       // å¤§å°æç¤º
    FontRole,           // å­—ä½“
    TextAlignmentRole,  // æ–‡æœ¬å¯¹é½
    BackgroundRole,     // èƒŒæ™¯è‰²
    ForegroundRole,     // å‰æ™¯è‰²
    CheckStateRole,     // å¤é€‰æ¡†çŠ¶æ€
    UserRole            // ç”¨æˆ·è‡ªå®šä¹‰è§’è‰²èµ·ç‚¹
};
```

### è‡ªå®šä¹‰æ¨¡å‹ç¤ºä¾‹

```cpp
class CustomTableModel : public QAbstractTableModel
{
    Q_OBJECT
public:
    explicit CustomTableModel(QObject *parent = nullptr);
    
    int rowCount(const QModelIndex &parent = QModelIndex()) const override;
    int columnCount(const QModelIndex &parent = QModelIndex()) const override;
    QVariant data(const QModelIndex &index, int role = Qt::DisplayRole) const override;
    QVariant headerData(int section, Qt::Orientation orientation, int role = Qt::DisplayRole) const override;
    bool setData(const QModelIndex &index, const QVariant &value, int role = Qt::EditRole) override;
    Qt::ItemFlags flags(const QModelIndex &index) const override;
    
    // è‡ªå®šä¹‰æ–¹æ³•
    void addItem(const QString &name, const QString &value);
    void removeItem(int row);
    
private:
    QList<QPair<QString, QString>> m_data;
};
```

## View (è§†å›¾)

### View çš„ç±»å‹

#### 1. åŸºç¡€è§†å›¾ç±»

- **QAbstractItemView**: æ‰€æœ‰è§†å›¾çš„æŠ½è±¡åŸºç±»
- **QListView**: åˆ—è¡¨è§†å›¾
- **QTableView**: è¡¨æ ¼è§†å›¾
- **QTreeView**: æ ‘å½¢è§†å›¾
- **QColumnView**: åˆ—è§†å›¾
- **QHeaderView**: è¡¨å¤´è§†å›¾

#### 2. ä¸“ç”¨è§†å›¾ç»„ä»¶

- **QListWidget**, **QTableWidget**, **QTreeWidget**: é›†æˆäº†é»˜è®¤æ¨¡å‹çš„ä¾¿æ·ç±»

### View çš„é…ç½®æ–¹æ³•

```cpp
// è®¾ç½®æ¨¡å‹
QTableView *tableView = new QTableView;
tableView->setModel(model);

// é€‰æ‹©æ¨¡å¼
tableView->setSelectionMode(QAbstractItemView::SingleSelection);
tableView->setSelectionBehavior(QAbstractItemView::SelectRows);

// æ˜¾ç¤ºè®¾ç½®
tableView->setShowGrid(true);
tableView->setGridStyle(Qt::DotLine);
tableView->setSortingEnabled(true);
tableView->setAlternatingRowColors(true);

// è°ƒæ•´æ˜¾ç¤º
tableView->resizeColumnsToContents();
tableView->resizeRowsToContents();
tableView->horizontalHeader()->setStretchLastSection(true);
```

### è§†å›¾é€‰æ‹©å¤„ç†

```cpp
// è¿æ¥é€‰æ‹©ä¿¡å·
connect(tableView->selectionModel(), &QItemSelectionModel::selectionChanged,
        this, &MyClass::handleSelectionChanged);

// å¤„ç†é€‰æ‹©å˜åŒ–
void MyClass::handleSelectionChanged(const QItemSelection &selected, const QItemSelection &deselected)
{
    QModelIndexList indexes = selected.indexes();
    if (!indexes.isEmpty()) {
        QModelIndex selectedIndex = indexes.first();
        // å¤„ç†é€‰ä¸­çš„é¡¹ç›®
    }
}
```

## Delegate (å§”æ‰˜)

### Delegate çš„ç±»å‹

- **QAbstractItemDelegate**: æ‰€æœ‰å§”æ‰˜çš„æŠ½è±¡åŸºç±»
- **QStyledItemDelegate**: ç°ä»£é£æ ¼å§”æ‰˜ï¼ˆæ¨èä½¿ç”¨ï¼‰
- **QItemDelegate**: ä¼ ç»Ÿé£æ ¼å§”æ‰˜

### Delegate çš„æ ¸å¿ƒæ–¹æ³•

```cpp
// å¿…é¡»å®ç°çš„æ–¹æ³•
void paint(QPainter *painter, const QStyleOptionViewItem &option, const QModelIndex &index) const;
QSize sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const;

// å¯ç¼–è¾‘é¡¹ç›®éœ€è¦å®ç°çš„æ–¹æ³•
QWidget *createEditor(QWidget *parent, const QStyleOptionViewItem &option, const QModelIndex &index) const;
void setEditorData(QWidget *editor, const QModelIndex &index) const;
void setModelData(QWidget *editor, QAbstractItemModel *model, const QModelIndex &index) const;
void updateEditorGeometry(QWidget *editor, const QStyleOptionViewItem &option, const QModelIndex &index) const;
```

### è‡ªå®šä¹‰å§”æ‰˜ç¤ºä¾‹

```cpp
class CustomDelegate : public QStyledItemDelegate
{
    Q_OBJECT
public:
    explicit CustomDelegate(QObject *parent = nullptr);
    
    void paint(QPainter *painter, const QStyleOptionViewItem &option, 
               const QModelIndex &index) const override;
    QSize sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const override;
    
    QWidget *createEditor(QWidget *parent, const QStyleOptionViewItem &option,
                         const QModelIndex &index) const override;
    void setEditorData(QWidget *editor, const QModelIndex &index) const override;
    void setModelData(QWidget *editor, QAbstractItemModel *model,
                     const QModelIndex &index) const override;
};
```

### å§”æ‰˜ä½¿ç”¨ç¤ºä¾‹

```cpp
// ä¸ºç‰¹å®šåˆ—è®¾ç½®å§”æ‰˜
QTableView *tableView = new QTableView;
tableView->setModel(model);

// ä¸ºç¬¬ä¸€åˆ—è®¾ç½®è‡ªå®šä¹‰å§”æ‰˜
tableView->setItemDelegateForColumn(0, new CustomDelegate(this));

// æˆ–è€…ä¸ºæ•´ä¸ªè§†å›¾è®¾ç½®å§”æ‰˜
tableView->setItemDelegate(new CustomDelegate(this));
```

## ååŒå·¥ä½œæœºåˆ¶

### 1. æ•°æ®æµï¼šModel â†’ View

```cpp
// Viewè¯·æ±‚æ•°æ®æ—¶
QVariant CustomModel::data(const QModelIndex &index, int role) const
{
    if (!index.isValid())
        return QVariant();
    
    if (role == Qt::DisplayRole) {
        // è¿”å›æ˜¾ç¤ºæ•°æ®
        return m_data[index.row()].first;
    } else if (role == Qt::UserRole) {
        // è¿”å›è‡ªå®šä¹‰æ•°æ®
        return m_data[index.row()].second;
    }
    
    return QVariant();
}
```

### 2. æ•°æ®ç¼–è¾‘ï¼šView â†’ Model

```cpp
// é€šè¿‡å§”æ‰˜ç¼–è¾‘æ•°æ®
void CustomDelegate::setModelData(QWidget *editor, QAbstractItemModel *model,
                                 const QModelIndex &index) const
{
    QLineEdit *lineEdit = qobject_cast<QLineEdit*>(editor);
    if (lineEdit) {
        model->setData(index, lineEdit->text(), Qt::EditRole);
    }
}
```

### 3. æ¨¡å‹æ›´æ–°é€šçŸ¥

```cpp
// æ¨¡å‹æ•°æ®å˜åŒ–æ—¶å‘å‡ºä¿¡å·
void CustomModel::addItem(const QString &name, const QString &value)
{
    beginInsertRows(QModelIndex(), m_data.size(), m_data.size());
    m_data.append(QPair<QString, QString>(name, value));
    endInsertRows();
    
    // æˆ–è€…ä½¿ç”¨dataChangedä¿¡å·æ›´æ–°ç°æœ‰æ•°æ®
    // QModelIndex topLeft = createIndex(0, 0);
    // QModelIndex bottomRight = createIndex(m_data.size()-1, 0);
    // emit dataChanged(topLeft, bottomRight);
}
```

### 4. å®Œæ•´åä½œç¤ºä¾‹

```cpp
// åˆ›å»ºæ¨¡å‹
CustomTableModel *model = new CustomTableModel(this);
model->addItem("Item 1", "Value 1");
model->addItem("Item 2", "Value 2");

// åˆ›å»ºè§†å›¾
QTableView *tableView = new QTableView;
tableView->setModel(model);

// è®¾ç½®å§”æ‰˜
tableView->setItemDelegateForColumn(0, new CustomDelegate(this));

// å¤„ç†é€‰æ‹©
connect(tableView->selectionModel(), &QItemSelectionModel::selectionChanged,
        [=](const QItemSelection &selected, const QItemSelection &deselected) {
    if (!selected.indexes().isEmpty()) {
        QModelIndex index = selected.indexes().first();
        QString data = model->data(index, Qt::UserRole).toString();
        qDebug() << "Selected item data:" << data;
    }
});

// å“åº”æ¨¡å‹å˜åŒ–
connect(model, &CustomTableModel::dataChanged,
        [=](const QModelIndex &topLeft, const QModelIndex &bottomRight) {
    qDebug() << "Data changed from row" << topLeft.row() << "to" << bottomRight.row();
});
```

## é«˜çº§ç‰¹æ€§

### 1. ä»£ç†æ¨¡å‹ (Proxy Models)

```cpp
// æ’åºè¿‡æ»¤ä»£ç†
QSortFilterProxyModel *proxyModel = new QSortFilterProxyModel;
proxyModel->setSourceModel(sourceModel);
proxyModel->setFilterRegularExpression(QRegularExpression("^A"));
proxyModel->setSortCaseSensitivity(Qt::CaseInsensitive);
tableView->setModel(proxyModel);

// è‡ªå®šä¹‰ä»£ç†æ¨¡å‹
class CustomProxyModel : public QSortFilterProxyModel
{
protected:
    bool filterAcceptsRow(int sourceRow, const QModelIndex &sourceParent) const override;
    bool lessThan(const QModelIndex &left, const QModelIndex &right) const override;
};
```

### 2. æ‹–æ”¾æ”¯æŒ

```cpp
// åœ¨æ¨¡å‹ä¸­å¯ç”¨æ‹–æ”¾
Qt::ItemFlags CustomModel::flags(const QModelIndex &index) const
{
    Qt::ItemFlags defaultFlags = QAbstractTableModel::flags(index);
    
    if (index.isValid())
        return defaultFlags | Qt::ItemIsDragEnabled | Qt::ItemIsDropEnabled;
    else
        return defaultFlags | Qt::ItemIsDropEnabled;
}

// å®ç°æ‹–æ”¾æ–¹æ³•
Qt::DropActions CustomModel::supportedDropActions() const
{
    return Qt::CopyAction | Qt::MoveAction;
}
```

### 3. è§†å›¾é€‰é¡¹é…ç½®

```cpp
// é…ç½®è§†å›¾è¡Œä¸º
tableView->setEditTriggers(QAbstractItemView::DoubleClicked | 
                          QAbstractItemView::EditKeyPressed);
tableView->setTabKeyNavigation(true);
tableView->setDragEnabled(true);
tableView->setDragDropMode(QAbstractItemView::InternalMove);
tableView->setDefaultDropAction(Qt::MoveAction);
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å®ç°åˆé€‚çš„`data()`æ–¹æ³•**ï¼šåªè¿”å›è¯·æ±‚çš„è§’è‰²æ•°æ®ï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—
2. **ä½¿ç”¨æ‰¹é‡æ“ä½œ**ï¼šå¯¹äºå¤§é‡æ•°æ®æ›´æ–°ï¼Œä½¿ç”¨`beginResetModel()`/`endResetModel()`æˆ–`beginInsertRows()`/`endInsertRows()`
3. **åˆç†ä½¿ç”¨ä»£ç†æ¨¡å‹**ï¼šé¿å…åœ¨ä»£ç†æ¨¡å‹ä¸­è¿›è¡Œå¤æ‚è®¡ç®—
4. **å®ç°`sort()`æ–¹æ³•**ï¼šå¯¹äºè‡ªå®šä¹‰æ¨¡å‹ï¼Œå®ç°é«˜æ•ˆçš„æ’åºç®—æ³•
5. **ä½¿ç”¨`fetchMore()`å’Œ`canFetchMore()`**ï¼šå¯¹äºå¤§å‹æ•°æ®é›†ï¼Œå®ç°å¢é‡åŠ è½½

è¿™ç§æ¶æ„æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œå…è®¸å¼€å‘è€…åˆ›å»ºé«˜åº¦å®šåˆ¶åŒ–çš„æ•°æ®å±•ç¤ºå’Œç¼–è¾‘ç•Œé¢ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„ç»„ç»‡æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚



# äº‹ä»¶è¿‡æ»¤å™¨çš„ä½œç”¨

äº‹ä»¶è¿‡æ»¤å™¨å…è®¸ä¸€ä¸ªå¯¹è±¡ï¼ˆç§°ä¸º**è¿‡æ»¤å™¨å¯¹è±¡**ï¼‰ç›‘è§†ç”šè‡³æ‹¦æˆªå‘é€åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆç§°ä¸º**ç›®æ ‡å¯¹è±¡**ï¼‰çš„äº‹ä»¶ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨äº‹ä»¶åˆ°è¾¾ç›®æ ‡å¯¹è±¡ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆâ€œæ£€æŸ¥â€å¹¶å†³å®šæ˜¯å¦è¦â€œå¤„ç†â€å®ƒï¼Œæˆ–è€…è®©å®ƒç»§ç»­ä¼ é€’ã€‚åœ¨ Qt ä¸­ä½¿ç”¨äº‹ä»¶è¿‡æ»¤å™¨å¯ä»¥è®©ä½ åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­æ‹¦æˆªå¹¶å¤„ç†å¦ä¸€ä¸ªå¯¹è±¡çš„äº‹ä»¶ï¼Œè¿™ä¸ºäº‹ä»¶å¤„ç†æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚ä¸‹é¢æˆ‘ä¼šä¸ºä½ ä»‹ç»å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨äº‹ä»¶è¿‡æ»¤å™¨ã€‚

*   **æ‹¦æˆªäº‹ä»¶**ï¼šä¾‹å¦‚ï¼Œå¯¹è¯æ¡†æ‹¦æˆªæŒ‰é”®äº‹ä»¶ï¼Œé˜»æ­¢å…¶ä»–ç»„ä»¶æ¥æ”¶ã€‚
*   **æ‰¹é‡å¤„ç†**ï¼šçˆ¶å®¹å™¨ç»Ÿä¸€å¤„ç†æ‰€æœ‰å­æ§ä»¶çš„äº‹ä»¶ï¼Œæ— éœ€ä¸ºæ¯ä¸ªå­æ§ä»¶å•ç‹¬ç¼–å†™é€»è¾‘ã€‚
*   **å…¨å±€ç›‘æ§**ï¼šåº”ç”¨ç¨‹åºçº§åˆ«çš„äº‹ä»¶ç›‘æ§ï¼Œå¦‚å…¨å±€å¿«æ·é”®ã€æ—¥å¿—è®°å½•ã€‚

### ğŸ“ å®šä¹‰ä¸ä½¿ç”¨äº‹ä»¶è¿‡æ»¤å™¨

ä½¿ç”¨äº‹ä»¶è¿‡æ»¤å™¨ä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼š

1.  **å®šä¹‰è¿‡æ»¤å™¨å¯¹è±¡å¹¶é‡å†™ `eventFilter` å‡½æ•°**
    ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `QObject` çš„ç±»ï¼ˆæˆ–è€…ä½¿ç”¨å·²æœ‰çš„ `QObject` å­ç±»ï¼‰ï¼Œå¹¶é‡å†™å…¶ `eventFilter` å‡½æ•°ã€‚

2.  **ç»™ç›®æ ‡å¯¹è±¡å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨**
    åœ¨ä½ å¸Œæœ›ç›‘è§†çš„å¯¹è±¡ä¸Šï¼Œè°ƒç”¨ `installEventFilter` æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ç¬¬ä¸€æ­¥ä¸­å‡†å¤‡å¥½çš„è¿‡æ»¤å™¨å¯¹è±¡ã€‚

#### 1. ä¸ºå•ä¸ªæ§ä»¶è®¾ç½®äº‹ä»¶è¿‡æ»¤å™¨ï¼ˆå¸¸ç”¨ï¼‰

å¦‚æœä½ æƒ³ä¸ºç‰¹å®šçš„æ§ä»¶ï¼ˆä¾‹å¦‚ä¸€ä¸ªæŒ‰é’®ã€æ–‡æœ¬æ¡†ï¼‰è®¾ç½®äº‹ä»¶è¿‡æ»¤å™¨ï¼š

**å®šä¹‰è¿‡æ»¤å™¨å¹¶é‡å†™ `eventFilter` å‡½æ•°**ï¼š

```cpp
#include <QObject>
#include <QEvent>
#include <QKeyEvent>
#include <QDebug>

class MyEventFilter : public QObject
{
    Q_OBJECT
public:
    explicit MyEventFilter(QObject *parent = nullptr) : QObject(parent) {}

protected:
    bool eventFilter(QObject *obj, QEvent *event) override
    {
        if (event->type() == QEvent::KeyPress) // ç¤ºä¾‹ï¼šè¿‡æ»¤é”®ç›˜æŒ‰ä¸‹äº‹ä»¶
        {
            QKeyEvent *keyEvent = static_cast<QKeyEvent*>(event);
            qDebug() << "Key pressed in" << obj->objectName() << ":" << keyEvent->key();
            // return true;  // å¦‚æœæ‹¦æˆªäº‹ä»¶ï¼Œé˜»æ­¢å…¶ç»§ç»­ä¼ é€’
        }
        // å¯¹äºå…¶ä»–äº‹ä»¶ï¼Œç»§ç»­ä¼ é€’
        return QObject::eventFilter(obj, event);
    }
};
```

**å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨**ï¼š

```cpp
// å‡è®¾åœ¨æŸå¤„æœ‰ä¸€ä¸ª QLineEdit å¯¹è±¡
QLineEdit *lineEdit = new QLineEdit(this);
lineEdit->setObjectName("MyLineEdit");

// åˆ›å»ºè¿‡æ»¤å™¨å¯¹è±¡å¹¶å®‰è£…
MyEventFilter *filter = new MyEventFilter(this);
lineEdit->installEventFilter(filter);
```

**åœ¨ç°æœ‰ç±»ï¼ˆå¦‚ä¸»çª—å£ï¼‰ä¸­ç›´æ¥å¤„ç†**ï¼š
ä½ ä¹Ÿå¯ä»¥åœ¨ç°æœ‰çš„ç±»ï¼ˆä¾‹å¦‚ `MainWindow`ï¼‰ä¸­ç›´æ¥é‡å†™ `eventFilter` æ–¹æ³•ï¼Œå¹¶ä¸ºè‡ªå·±æˆ–å­æ§ä»¶å®‰è£…è¿‡æ»¤å™¨ (`installEventFilter(this)`)ã€‚

```cpp
// ç¤ºä¾‹ï¼šåœ¨ä¸»çª—å£ä¸­è¿‡æ»¤å­æ§ä»¶çš„äº‹ä»¶
bool MainWindow::eventFilter(QObject *obj, QEvent *event)
{
    if (obj == ui->textEdit && event->type() == QEvent::KeyPress) {
        QKeyEvent *keyEvent = static_cast<QKeyEvent*>(event);
        if (keyEvent->key() == Qt::Key_Return || keyEvent->key() == Qt::Key_Enter) {
            qDebug() << "å›è½¦é”®è¢«æ‹¦æˆª";
            return true; // æ‹¦æˆªå›è½¦é”®äº‹ä»¶
        }
    }
    return QMainWindow::eventFilter(obj, event); // å…¶ä»–äº‹ä»¶äº¤ç»™çˆ¶ç±»å¤„ç†
}

// åœ¨æ„é€ å‡½æ•°ä¸­å®‰è£…
MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent), ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    ui->textEdit->installEventFilter(this); // ä¸ºtextEditå®‰è£…è¿‡æ»¤å™¨ï¼Œä½¿ç”¨thisï¼ˆMainWindowï¼‰ä½œä¸ºè¿‡æ»¤å™¨å¯¹è±¡
}
```

#### 2. ä¸ºçˆ¶å®¹å™¨è®¾ç½®äº‹ä»¶è¿‡æ»¤å™¨ï¼ˆæ‰¹é‡å¤„ç†ï¼‰

å¦‚æœä½ æƒ³æ‰¹é‡å¤„ç†æŸä¸ªå®¹å™¨å†…æ‰€æœ‰å­æ§ä»¶çš„äº‹ä»¶ï¼Œå¯ä»¥åœ¨çˆ¶å®¹å™¨ä¸Šå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨ã€‚

```cpp
class ContainerWidget : public QWidget
{
    Q_OBJECT
public:
    ContainerWidget(QWidget *parent = nullptr) : QWidget(parent)
    {
        // åˆ›å»ºä¸€äº›å­æ§ä»¶...
        installEventFilter(this); // ä¸ºå®¹å™¨è‡ªèº«å®‰è£…è¿‡æ»¤å™¨
    }

    bool eventFilter(QObject *obj, QEvent *event) override
    {
        // é€šè¿‡åˆ¤æ–­ obj æ˜¯å¦æ˜¯å­æ§ä»¶æ¥å¤„ç†äº‹ä»¶
        if (obj->parent() == this && event->type() == QEvent::MouseButtonPress) {
            qDebug() << "å­æ§ä»¶è¢«ç‚¹å‡»:" << obj->objectName();
            // å¤„ç†é€»è¾‘
        }
        return QWidget::eventFilter(obj, event);
    }
};
```

#### 3. å…¨å±€äº‹ä»¶è¿‡æ»¤å™¨

ä½ è¿˜å¯ä»¥ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºå®‰è£…å…¨å±€äº‹ä»¶è¿‡æ»¤å™¨ï¼Œä»¥ç›‘æ§æ‰€æœ‰äº‹ä»¶ã€‚

```cpp
#include <QApplication>

class GlobalEventFilter : public QObject
{
    Q_OBJECT
protected:
    bool eventFilter(QObject *obj, QEvent *event) override
    {
        if (event->type() == QEvent::KeyPress) {
            QKeyEvent *keyEvent = static_cast<QKeyEvent*>(event);
            if (keyEvent->key() == Qt::Key_F1) {
                qDebug() << "å…¨å±€ F1 æŒ‰é”®è¢«æŒ‰ä¸‹";
                return true;
            }
        }
        return QObject::eventFilter(obj, event);
    }
};

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    GlobalEventFilter globalFilter;
    app.installEventFilter(&globalFilter); // ç»™åº”ç”¨å®‰è£…å…¨å±€è¿‡æ»¤å™¨

    // ...
    return app.exec();
}
```

### âš ï¸ æ³¨æ„äº‹é¡¹

1.  **äº‹ä»¶ä¼ æ’­**ï¼š`eventFilter` å‡½æ•°çš„è¿”å›å€¼å¾ˆé‡è¦ã€‚
    *   `return true`ï¼šè¡¨ç¤ºäº‹ä»¶å·²è¢«å¤„ç†ï¼Œ**ä¸å†**ä¼ é€’ç»™ç›®æ ‡å¯¹è±¡ã€‚
    *   `return false`ï¼šè¡¨ç¤ºäº‹ä»¶**ç»§ç»­**ä¼ é€’ç»™ç›®æ ‡å¯¹è±¡æˆ–å…¶åç»­è¿‡æ»¤å™¨ã€‚
2.  **æ‰§è¡Œé¡ºåº**ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡å®‰è£…äº†**å¤šä¸ª**äº‹ä»¶è¿‡æ»¤å™¨ï¼Œé‚£ä¹ˆ**æœ€åå®‰è£…çš„è¿‡æ»¤å™¨ä¼šæœ€å…ˆæ‰§è¡Œ**ã€‚
3.  **çº¿ç¨‹äº²å’Œæ€§**ï¼šäº‹ä»¶è¿‡æ»¤å™¨å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å¿…é¡»å¤„äº**åŒä¸€çº¿ç¨‹**ï¼Œå¦åˆ™è¿‡æ»¤å™¨å°†æ— æ•ˆã€‚
4.  **å†…å­˜ç®¡ç†**ï¼š
    *   ç¡®ä¿è¿‡æ»¤å™¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ**é•¿äº**ç›®æ ‡å¯¹è±¡ï¼Œä»¥é¿å…æ‚¬ç©ºæŒ‡é’ˆã€‚é€šå¸¸å°†è¿‡æ»¤å™¨çš„çˆ¶å¯¹è±¡è®¾ç½®ä¸ºç›®æ ‡å¯¹è±¡æˆ–å…¶çˆ¶å¯¹è±¡ï¼Œåˆ©ç”¨ Qt çš„å¯¹è±¡æ ‘æœºåˆ¶è¿›è¡Œå†…å­˜ç®¡ç†ã€‚
    *   å¦‚æœåœ¨äº‹ä»¶è¿‡æ»¤å™¨ä¸­**åˆ é™¤**äº†æ¥æ”¶äº‹ä»¶çš„å¯¹è±¡ï¼ŒåŠ¡å¿…è®© `eventFilter` å‡½æ•°è¿”å› `true`ï¼Œå¦åˆ™ Qt å¯èƒ½è¿˜ä¼šå°è¯•å‘å·²åˆ é™¤çš„å¯¹è±¡å‘é€äº‹ä»¶ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚
5.  **æ€§èƒ½è€ƒé‡**ï¼šå…¨å±€äº‹ä»¶è¿‡æ»¤å™¨ä¼šå¯¹**æ¯ä¸ªäº‹ä»¶**è¿›è¡Œæ£€æŸ¥ï¼Œåº”è°¨æ…ä½¿ç”¨ä»¥é¿å…æ€§èƒ½é—®é¢˜ã€‚

### ğŸ’¡ åº”ç”¨åœºæ™¯

äº‹ä»¶è¿‡æ»¤å™¨åœ¨å¤„ç†è¿™äº›åœºæ™¯æ—¶éå¸¸æœ‰ç”¨ï¼š

*   **è‡ªå®šä¹‰æ§ä»¶è¡Œä¸º**ï¼šä¾‹å¦‚ï¼Œåœ¨ QLineEdit ä¸­æŒ‰å›è½¦é”®æ‰§è¡Œç‰¹å®šæ“ä½œè€Œéé»˜è®¤è¡Œä¸ºã€‚
*   **éªŒè¯è¾“å…¥**ï¼šåœ¨ç„¦ç‚¹ç¦»å¼€è¾“å…¥æ¡†ï¼ˆ`QEvent::FocusOut`ï¼‰æ—¶éªŒè¯å†…å®¹æœ‰æ•ˆæ€§ã€‚
*   **æ‰¹é‡æ“ä½œ**ï¼šç»Ÿä¸€ç¦ç”¨æˆ–ä¿®æ”¹ä¸€ç»„æ§ä»¶çš„é¼ æ ‡æ»šè½®äº‹ä»¶ã€‚
*   **å®ç°å…¨å±€å¿«æ·é”®**ï¼šæ•è·åº”ç”¨ç¨‹åºçº§åˆ«çš„ç‰¹å®šæŒ‰é”®ç»„åˆã€‚
*   **ç›‘æ§ç”¨æˆ·æ´»åŠ¨**ï¼šè®°å½•ç”¨æˆ·ä¸ç•Œé¢äº¤äº’çš„æ—¥å¿—ã€‚

### ğŸ“Š ä¸‰ç§äº‹ä»¶è¿‡æ»¤å™¨å¯¹æ¯”

| ç±»å‹               | ä½œç”¨èŒƒå›´           | æ€§èƒ½å½±å“ | é€‚ç”¨åœºæ™¯                 |
| :----------------- | :----------------- | :------- | :----------------------- |
| **å•ä¸ªæ§ä»¶è¿‡æ»¤å™¨** | ç‰¹å®šæ§ä»¶åŠå…¶å­æ§ä»¶ | ä½       | ç²¾ç»†åŒ–æ§åˆ¶å•ä¸ªæ§ä»¶äº‹ä»¶   |
| **çˆ¶å®¹å™¨è¿‡æ»¤å™¨**   | å®¹å™¨åŠå…¶æ‰€æœ‰å­æ§ä»¶ | ä¸­       | æ‰¹é‡å¤„ç†åŒç±»å­æ§ä»¶äº‹ä»¶   |
| **å…¨å±€è¿‡æ»¤å™¨**     | å…¨åº”ç”¨æ‰€æœ‰æ§ä»¶     | é«˜       | å…¨å±€ç›‘æ§ã€ç³»ç»Ÿçº§äº‹ä»¶å¤„ç† |

### ğŸŒ° ç®€å•ç¤ºä¾‹

å‡è®¾ä½ æƒ³é˜»æ­¢ä¸€ä¸ª QLineEdit æ§ä»¶æ¥æ”¶å›è½¦é”®äº‹ä»¶ï¼š

```cpp
// åœ¨åŒ…å«è¯¥QLineEditçš„çª—å£ç±»ï¼ˆå¦‚MainWindowï¼‰çš„æ„é€ å‡½æ•°ä¸­ï¼š
ui->lineEdit->installEventFilter(this);

// åœ¨è¯¥çª—å£ç±»ä¸­é‡å†™eventFilterå‡½æ•°ï¼š
bool MainWindow::eventFilter(QObject *obj, QEvent *event)
{
    if (obj == ui->lineEdit && event->type() == QEvent::KeyPress) {
        QKeyEvent *keyEvent = static_cast<QKeyEvent*>(event);
        if (keyEvent->key() == Qt::Key_Return || keyEvent->key() == Qt::Key_Enter) {
            // æ‹¦æˆªå›è½¦é”®
            qDebug() << "å›è½¦é”®è¢«è¿‡æ»¤";
            return true; // äº‹ä»¶å·²å¤„ç†ï¼Œä¸å†ä¼ é€’
        }
    }
    // å…¶ä»–äº‹ä»¶ç»§ç»­ä¼ é€’
    return QMainWindow::eventFilter(obj, event);
}
```

æ€»ä¹‹ï¼ŒQt çš„äº‹ä»¶è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„å·¥å…·ï¼Œé€šè¿‡é‡å†™ `eventFilter` æ–¹æ³•å’Œä½¿ç”¨ `installEventFilter` å®‰è£…ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°æ‹¦æˆªå’Œå¤„ç†äº‹ä»¶ã€‚ä½¿ç”¨æ—¶åªéœ€æ³¨æ„äº‹ä»¶ä¼ æ’­ã€è¿‡æ»¤å™¨é¡ºåºå’Œå†…å­˜ç®¡ç†ç­‰ç»†èŠ‚å³å¯ã€‚

# Qt ScrollBar è¯¦ç»†è¯´æ˜

`QScrollBar` æ˜¯ Qt ä¸­ç”¨äºæä¾›æ»šåŠ¨åŠŸèƒ½çš„æ§ä»¶ï¼Œå®ƒå…è®¸ç”¨æˆ·æŸ¥çœ‹è¶…å‡ºå¯è§†åŒºåŸŸçš„å†…å®¹ã€‚åœ¨ `QListWidget`ã€`QTableView` ç­‰å¯æ»šåŠ¨æ§ä»¶ä¸­ï¼ŒScrollBar æ˜¯è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†çš„ã€‚

## ScrollBar åŸºæœ¬æ¦‚å¿µ

### 1. ä»€ä¹ˆæ˜¯ ScrollBarï¼Ÿ

ScrollBarï¼ˆæ»šåŠ¨æ¡ï¼‰æ˜¯ä¸€ä¸ªå›¾å½¢ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼Œç”¨äºï¼š

- æŒ‡ç¤ºå½“å‰åœ¨å†…å®¹ä¸­çš„ä½ç½®
- å…è®¸ç”¨æˆ·é€šè¿‡æ‹–åŠ¨ã€ç‚¹å‡»ç®­å¤´æˆ–ç‚¹å‡»è½¨é“æ¥å¯¼èˆªå†…å®¹
- æ˜¾ç¤ºå†…å®¹çš„ç›¸å¯¹å¤§å°å’Œå½“å‰ä½ç½®

### 2. ScrollBar çš„ç»„æˆéƒ¨åˆ†

```
[â–²] [=================â– ================] [â–¼]
 â†‘         â†‘                 â†‘           â†‘
å‘ä¸ŠæŒ‰é’®   è½¨é“          æ»‘å—(æ‹‡æŒ‡)     å‘ä¸‹æŒ‰é’®
```

### 3. ScrollBar çš„ç±»å‹

- **å‚ç›´æ»šåŠ¨æ¡** (`Qt::Vertical`) - ç”¨äºä¸Šä¸‹æ»šåŠ¨
- **æ°´å¹³æ»šåŠ¨æ¡** (`Qt::Horizontal`) - ç”¨äºå·¦å³æ»šåŠ¨

## åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨ ScrollBar

### 1. è·å–å’Œè®¾ç½® ScrollBar

```cpp
// è·å–å‚ç›´æ»šåŠ¨æ¡
QScrollBar *verticalScrollBar = this->verticalScrollBar();

// è·å–æ°´å¹³æ»šåŠ¨æ¡  
QScrollBar *horizontalScrollBar = this->horizontalScrollBar();

// è®¾ç½®æ»šåŠ¨æ¡ç­–ç•¥
this->setVerticalScrollBarPolicy(Qt::ScrollBarAsNeeded); // éœ€è¦æ—¶æ˜¾ç¤º
this->setVerticalScrollBarPolicy(Qt::ScrollBarAlwaysOn); // æ€»æ˜¯æ˜¾ç¤º
this->setVerticalScrollBarPolicy(Qt::ScrollBarAlwaysOff); // æ€»æ˜¯éšè—

// è®¾ç½®æ»šåŠ¨æ¡æ ·å¼
verticalScrollBar->setStyleSheet("QScrollBar:vertical {"
                                 "    border: none;"
                                 "    background: #f0f0f0;"
                                 "    width: 10px;"
                                 "    margin: 0px 0px 0px 0px;"
                                 "}"
                                 "QScrollBar::handle:vertical {"
                                 "    background: #c0c0c0;"
                                 "    min-height: 20px;"
                                 "    border-radius: 5px;"
                                 "}");
```

### 2. ScrollBar çš„é‡è¦å±æ€§å’Œæ–¹æ³•

```cpp
// è·å–å’Œè®¾ç½®å½“å‰å€¼
int currentValue = verticalScrollBar->value(); // è·å–å½“å‰å€¼
verticalScrollBar->setValue(100); // è®¾ç½®å½“å‰ä½ç½®

// è·å–èŒƒå›´ä¿¡æ¯
int minimum = verticalScrollBar->minimum(); // æœ€å°å€¼ï¼ˆé€šå¸¸ä¸º0ï¼‰
int maximum = verticalScrollBar->maximum(); // æœ€å¤§å€¼ï¼ˆå†…å®¹é«˜åº¦ - å¯è§†é«˜åº¦ï¼‰
int pageStep = verticalScrollBar->pageStep(); // é¡µé¢æ­¥é•¿ï¼ˆå¯è§†åŒºåŸŸé«˜åº¦ï¼‰

// è®¾ç½®èŒƒå›´
verticalScrollBar->setRange(0, totalHeight - visibleHeight);

// è¿æ¥å€¼æ”¹å˜ä¿¡å·
connect(verticalScrollBar, &QScrollBar::valueChanged, [](int value) {
    qDebug() << "Scroll position changed to:" << value;
});

// è¿æ¥æ»šåŠ¨èŒƒå›´æ”¹å˜ä¿¡å·
connect(verticalScrollBar, &QScrollBar::rangeChanged, [](int min, int max) {
    qDebug() << "Scroll range changed. Min:" << min << "Max:" << max;
});
```

## ä¿®å¤ä½ çš„ä»£ç 

ä½ çš„ä»£ç ä¸­æœ‰å‡ ä¸ªé—®é¢˜éœ€è¦ä¿®å¤ï¼š

### 1. æ»šè½®äº‹ä»¶å¤„ç†é—®é¢˜

```cpp
if (watched == this->viewport() && event->type() == QEvent::Wheel) {
    QWheelEvent *wheelEvent = static_cast<QWheelEvent*>(event);
    
    // ç°ä»£Qtç‰ˆæœ¬æ¨èä½¿ç”¨pixelDeltaè€Œä¸æ˜¯angleDelta
    if (!wheelEvent->pixelDelta().isNull()) {
        // ä½¿ç”¨åƒç´ ç²¾åº¦çš„æ»šåŠ¨
        QPoint pixelDelta = wheelEvent->pixelDelta();
        this->verticalScrollBar()->setValue(
            this->verticalScrollBar()->value() - pixelDelta.y()
        );
    } else if (!wheelEvent->angleDelta().isNull()) {
        // ä½¿ç”¨è§’åº¦ç²¾åº¦çš„æ»šåŠ¨ï¼ˆä¼ ç»Ÿé¼ æ ‡ï¼‰
        QPoint angleDelta = wheelEvent->angleDelta();
        this->verticalScrollBar()->setValue(
            this->verticalScrollBar()->value() - angleDelta.y() / 8
        );
    }
    
    // æ£€æŸ¥æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨
    QScrollBar *scrollBar = this->verticalScrollBar();
    bool atBottom = (scrollBar->value() >= scrollBar->maximum());
    
    if (atBottom) {
        qDebug() << "Reached bottom, loading more chat users";
        emit sig_loading_chat_user();
    }
    
    return true; // é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
}
```

### 2. æ”¹è¿›çš„æ»šåŠ¨æ£€æµ‹é€»è¾‘

```cpp
// æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡æ¥è·Ÿè¸ªåŠ è½½çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤åŠ è½½
bool isLoading = false;

// åœ¨äº‹ä»¶è¿‡æ»¤å™¨ä¸­
if (watched == this->viewport() && event->type() == QEvent::Wheel) {
    QWheelEvent *wheelEvent = static_cast<QWheelEvent*>(event);
    
    // å¤„ç†æ»šåŠ¨
    QPoint delta;
    if (!wheelEvent->pixelDelta().isNull()) {
        delta = wheelEvent->pixelDelta();
    } else {
        delta = wheelEvent->angleDelta() / 8;
    }
    
    int newValue = this->verticalScrollBar()->value() - delta.y();
    this->verticalScrollBar()->setValue(newValue);
    
    // æ£€æŸ¥æ˜¯å¦æ¥è¿‘åº•éƒ¨ï¼ˆæ·»åŠ ä¸€äº›é˜ˆå€¼é˜²æ­¢è¿‡äºæ•æ„Ÿï¼‰
    QScrollBar *scrollBar = this->verticalScrollBar();
    int threshold = 50; // è·ç¦»åº•éƒ¨50åƒç´ æ—¶è§¦å‘åŠ è½½
    
    bool nearBottom = (scrollBar->value() >= scrollBar->maximum() - threshold);
    
    if (nearBottom && !isLoading) {
        isLoading = true;
        qDebug() << "Near bottom, loading more chat users";
        emit sig_loading_chat_user();
        
        // å¯ä»¥ä½¿ç”¨QTimerç¨åé‡ç½®isLoadingï¼Œæˆ–è€…åœ¨æœ‰æ–°æ•°æ®åŠ è½½å®Œæˆåé‡ç½®
        QTimer::singleShot(1000, this, [this]() { isLoading = false; });
    }
    
    return true;
}
```

### 3. å®Œæ•´çš„æ”¹è¿›ç‰ˆæœ¬

```cpp
bool ChatUserList::eventFilter(QObject *watched, QEvent *event)
{
    // é¼ æ ‡æ‚¬æµ®æ˜¾ç¤º/éšè—æ»šåŠ¨æ¡
    if (watched == this->viewport()) {
        if (event->type() == QEvent::Enter) {
            this->setVerticalScrollBarPolicy(Qt::ScrollBarAsNeeded);
        } else if (event->type() == QEvent::Leave) {
            this->setVerticalScrollBarPolicy(Qt::ScrollBarAlwaysOff);
        }
    }
    
    // é¼ æ ‡æ»šè½®äº‹ä»¶
    if (watched == this->viewport() && event->type() == QEvent::Wheel) {
        QWheelEvent *wheelEvent = static_cast<QWheelEvent*>(event);
        
        // å¤„ç†æ»šåŠ¨
        int deltaY = 0;
        if (!wheelEvent->pixelDelta().isNull()) {
            deltaY = wheelEvent->pixelDelta().y();
        } else if (!wheelEvent->angleDelta().isNull()) {
            deltaY = wheelEvent->angleDelta().y() / 8;
        }
        
        if (deltaY != 0) {
            QScrollBar *scrollBar = this->verticalScrollBar();
            int newValue = scrollBar->value() - deltaY;
            scrollBar->setValue(newValue);
            
            // æ£€æŸ¥æ˜¯å¦æ¥è¿‘åº•éƒ¨
            static bool isLoading = false;
            int threshold = 50; // è·ç¦»åº•éƒ¨50åƒç´ æ—¶è§¦å‘
            
            if (scrollBar->value() >= scrollBar->maximum() - threshold && !isLoading) {
                isLoading = true;
                qDebug() << "Loading more chat users";
                emit sig_loading_chat_user();
                
                // 1ç§’åé‡ç½®åŠ è½½çŠ¶æ€
                QTimer::singleShot(1000, this, [&isLoading]() { isLoading = false; });
            }
        }
        
        return true; // é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
    }
    
    return QListWidget::eventFilter(watched, event);
}
```

## è‡ªå®šä¹‰ ScrollBar è¡Œä¸ºç¤ºä¾‹

```cpp
// è‡ªå®šä¹‰å¹³æ»‘æ»šåŠ¨
void ChatUserList::smoothScrollTo(int value)
{
    QScrollBar *scrollBar = this->verticalScrollBar();
    int currentValue = scrollBar->value();
    
    // åˆ›å»ºåŠ¨ç”»
    QPropertyAnimation *animation = new QPropertyAnimation(scrollBar, "value");
    animation->setDuration(300); // 300æ¯«ç§’åŠ¨ç”»
    animation->setStartValue(currentValue);
    animation->setEndValue(value);
    animation->setEasingCurve(QEasingCurve::OutCubic); // å¹³æ»‘çš„ç¼“åŠ¨æ›²çº¿
    animation->start(QPropertyAnimation::DeleteWhenStopped);
}

// åœ¨éœ€è¦çš„åœ°æ–¹è°ƒç”¨
smoothScrollTo(targetPosition);
```

## æ€»ç»“

1. **QScrollBar** æ˜¯ Qt ä¸­ç®¡ç†æ»šåŠ¨åŠŸèƒ½çš„æ§ä»¶
2. å¯ä»¥é€šè¿‡ `verticalScrollBar()` å’Œ `horizontalScrollBar()` æ–¹æ³•è®¿é—®
3. é‡è¦å±æ€§ï¼š`value`ï¼ˆå½“å‰ä½ç½®ï¼‰ã€`minimum`/`maximum`ï¼ˆèŒƒå›´ï¼‰ã€`pageStep`ï¼ˆé¡µé¢å¤§å°ï¼‰
4. åœ¨ä½ çš„ä»£ç ä¸­ï¼Œéœ€è¦æ­£ç¡®å¤„ç†æ»šè½®äº‹ä»¶å¹¶æ£€æŸ¥æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨
5. æ·»åŠ é˜ˆå€¼å’ŒåŠ è½½çŠ¶æ€è·Ÿè¸ªå¯ä»¥é˜²æ­¢é‡å¤åŠ è½½é—®é¢˜
6. å¯ä»¥è€ƒè™‘ä½¿ç”¨åŠ¨ç”»å®ç°æ›´å¹³æ»‘çš„æ»šåŠ¨æ•ˆæœ

é€šè¿‡æ­£ç¡®ä½¿ç”¨ ScrollBarï¼Œä½ å¯ä»¥åˆ›å»ºå‡ºç”¨æˆ·ä½“éªŒè‰¯å¥½çš„å¯æ»šåŠ¨ç•Œé¢ã€‚